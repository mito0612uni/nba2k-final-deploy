{% extends "layout.html" %}
{% block content %}
<style>
  /* --- ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ©ãƒƒãƒ‘ãƒ¼ --- */
  .homepage-wrapper {
    position: relative; border-radius: 8px; overflow: hidden; color: #ffffff; padding: 25px; min-height: 80vh;
  }
  .homepage-wrapper::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=1400&q=80');
    background-size: cover; background-position: center; background-attachment: fixed; z-index: -2;
  }
  .homepage-wrapper::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0, 0, 0, 0.75); z-index: -1;
  }
  .homepage-wrapper h1, .homepage-wrapper h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); }
  .homepage-wrapper h3 { color: #eee; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }

  /* â˜…â˜…â˜… æŠ•ç¥¨ãƒãƒŠãƒ¼ (è¦–èªæ€§å‘ä¸Š) â˜…â˜…â˜… */
  .vote-banner {
      background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); /* ç›®ç«‹ã¤ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      color: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
      border: 2px solid #fff;
  }
  .vote-banner h3 {
      color: #000; font-weight: 900; margin-top: 0; text-shadow: none; font-size: 1.5em;
  }
  .vote-btn {
      background-color: #333; color: #fff; padding: 12px 25px; border-radius: 30px;
      text-decoration: none; font-weight: bold; display: inline-block; margin-top: 10px;
      transition: transform 0.2s, background-color 0.2s; border: 2px solid #333;
  }
  .vote-btn:hover {
      background-color: #fff; color: #333; transform: scale(1.05); text-decoration: none;
  }

  /* â˜…â˜…â˜… ã‚¢ãƒ¯ãƒ¼ãƒ‰çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ â˜…â˜…â˜… */
  .award-section { margin-bottom: 40px; }
  .award-header { 
      text-align: center; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffd700; 
  }
  .award-header h2 { border: none; margin: 0; color: #ffd700; }
  
  .award-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
  .award-card {
      background: rgba(255,255,255,0.95); color: #333; border-radius: 8px; padding: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  .award-title {
      font-size: 1.2em; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; text-align: center; color: #004a99;
  }
  .award-row {
      display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #ccc; align-items: center;
  }
  .award-pos { font-weight: bold; width: 40px; color: #555; }
  .award-player { flex-grow: 1; font-weight: bold; }
  .award-score { font-size: 0.9em; color: #666; }

  /* (æ—¢å­˜ã®MVPã‚»ã‚¯ã‚·ãƒ§ãƒ³ç­‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ãã®ã¾ã¾ç¶­æŒ) */
  .mvp-section { margin-bottom: 30px; }
  .mvp-header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid #ffd700; padding-bottom: 5px; }
  .mvp-header h2 { border: none; margin: 0; color: #ffd700; }
  .mvp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
  .mvp-column h3 { text-align: center; background-color: rgba(0,0,0,0.5); color: #fff; padding: 5px; border-radius: 6px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.2); font-size: 1em; }
  .mvp-card { background-color: rgba(255,255,255,0.95); color: #333; border-radius: 6px; padding: 8px 12px; margin-bottom: 8px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); height: auto; }
  .mvp-img { width: 40px; height: 40px; object-fit: contain; margin-right: 10px; border-radius: 50%; background: #fff; border: 1px solid #ddd; }
  .mvp-info { flex-grow: 1; }
  .mvp-name { font-weight: bold; font-size: 0.95em; display: block; color: #004a99; text-decoration: none; }
  .mvp-stats { font-size: 0.7em; color: #666; margin-top: 2px; line-height: 1.4; }
  .mvp-stats strong { color: #333; font-size: 1.1em; margin-right: 1px; }

  /* ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€ã‚¿ãƒ–ã€ãƒ†ãƒ¼ãƒ–ãƒ«ç­‰ã®ã‚¹ã‚¿ã‚¤ãƒ« (çœç•¥ãªã—ã§å…¨ã¦è¨˜è¿°) */
  .news-section { background-color: rgba(0, 0, 0, 0.6); border: 1px solid #555; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
  .news-item { border-bottom: 1px solid #777; padding: 15px 0; } .news-item:last-child { border-bottom: none; }
  .news-item h4 { margin: 0 0 5px; color: #4dabf7; font-size: 1.3em; } .news-date { color: #ccc; font-size: 0.9em; } .news-content { margin: 0; line-height: 1.6; }
  .tab-navigation { display: flex; gap: 5px; margin-bottom: -1px; }
  .tab-btn { padding: 12px 22px; background: rgba(0,0,0,0.6); color: #ccc; border: 1px solid #555; border-bottom: none; border-radius: 6px 6px 0 0; cursor: pointer; font-weight: bold; }
  .tab-btn.active { background: rgba(255,255,255,0.9); color: #333; border-color: #fff; }
  .tab-content { display: none; background: rgba(255,255,255,0.9); border: 1px solid #fff; padding: 20px; border-radius: 0 6px 6px 6px; color: #333; }
  .tab-content.active { display: block; }
  .stats-table { width: 100%; border-collapse: collapse; overflow-x: auto; display: block; }
  .stats-table th, .stats-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; white-space: nowrap; }
  .stats-table th { background: #f1f1f1; color: #333; } .stats-table td { color: #333; } .stats-table tr:hover { background: #f9f9f9; }
  .stats-table a { color: #004a99; text-decoration: none; font-weight: bold; }
  .team-cell { display: flex; align-items: center; gap: 10px; } .team-cell img { height: 25px; }
  .league-tag { font-size: 12px; padding: 3px 8px; border-radius: 10px; font-weight: bold; }
  .league-tag-a { background: #ffebee; color: #c62828; } .league-tag-b { background: #e3f2fd; color: #1565c0; }
  .upcoming-game-item { background: rgba(255,255,255,0.9); border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; color: #333; }
  .game-teams { font-weight: bold; font-size: 1.1em; } .game-teams img { height: 20px; margin: 0 5px; vertical-align: middle; }
  .game-link a { background: #007bff; color: #fff; padding: 8px 12px; border-radius: 4px; text-decoration: none; }
  .team-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
  .team-card { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; text-align: center; color: #333; text-decoration: none; } .team-card:hover { transform: translateY(-5px); }
  .team-card img { width: 80px; margin-bottom: 10px; }
</style>

<div class="homepage-wrapper">
  <h1>NBA2K JPL</h1>

  {% if active_votes %}
  <div class="vote-banner">
      <h3>ğŸ“¢ ç¾åœ¨ã€æŠ•ç¥¨ã‚’å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ï¼</h3>
      <p style="margin: 10px 0;">ã‚ãªãŸã®1ç¥¨ãŒãƒªãƒ¼ã‚°ã‚’ç››ã‚Šä¸Šã’ã¾ã™ã€‚ãœã²ã”å‚åŠ ãã ã•ã„ã€‚</p>
      <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
          {% for vote in active_votes %}
              <a href="{{ url_for('vote_page', config_id=vote.id) }}" class="vote-btn">
                  {{ vote.title }} ã«æŠ•ç¥¨ã™ã‚‹ ğŸ—³ï¸
              </a>
          {% endfor %}
      </div>
  </div>
  {% endif %}

  {% if latest_result %}
  <div class="latest-result-banner">
      <p style="margin: 0;">
          çµæœå…¥åŠ›: 
          {{ latest_result.home_team.name }}
          <a href="{{ url_for('game_result', game_id=latest_result.id) }}">
              {{ latest_result.home_score }} - {{ latest_result.away_score }}
          </a>
          {{ latest_result.away_team.name }}
      </p>
  </div>
  {% endif %}

  {% for p_vote in published_votes %}
  <div class="award-section">
      <div class="award-header">
          <h2>ğŸ† {{ p_vote.title }} çµæœç™ºè¡¨</h2>
      </div>
      
      {% if p_vote.vote_type == 'weekly' %}
         <div class="award-card" style="text-align: center;">
             {% for res in p_vote.results if res.rank == 1 %}
                 <h3 style="color:#004a99; margin-top:0;">ğŸ‰ {{ res.player.name }} <small>({{ res.player.team.name }})</small></h3>
                 <p style="font-size:1.2em; font-weight:bold;">{{ res.score }}ç¥¨</p>
             {% endfor %}
         </div>
      
      {% elif p_vote.vote_type == 'all_star' %}
         <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
             <div class="award-card" style="border-top: 5px solid #c62828;">
                 <h3 style="text-align:center; color:#c62828; margin-top:0;">Aãƒªãƒ¼ã‚°</h3>
                 {% for res in p_vote.results if 'Aãƒªãƒ¼ã‚°' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('Aãƒªãƒ¼ã‚° ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}ç¥¨</span>
                     </div>
                 {% endfor %}
             </div>
             <div class="award-card" style="border-top: 5px solid #1565c0;">
                 <h3 style="text-align:center; color:#1565c0; margin-top:0;">Bãƒªãƒ¼ã‚°</h3>
                 {% for res in p_vote.results if 'Bãƒªãƒ¼ã‚°' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('Bãƒªãƒ¼ã‚° ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}ç¥¨</span>
                     </div>
                 {% endfor %}
             </div>
         </div>

      {% elif p_vote.vote_type == 'awards' %}
         <div class="award-grid">
             <div class="award-card">
                 <div class="award-title">å€‹äººè³</div>
                 {% for res in p_vote.results if res.category in ['MVP', 'DPOY'] and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos" style="width:60px;">{{ res.category }}</span>
                         <span class="award-player" style="font-size:1.1em;">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>

             <div class="award-card">
                 <div class="award-title">All JPL 1st Team</div>
                 {% for res in p_vote.results if '1st' in res.category %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% else %}
                     <p style="text-align:center; color:#999;">é›†è¨ˆãƒ‡ãƒ¼ã‚¿ãªã—</p>
                 {% endfor %}
             </div>

             <div class="award-card">
                 <div class="award-title">All JPL 2nd Team</div>
                 {% for res in p_vote.results if '2nd' in res.category %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>
             
             <div class="award-card">
                 <div class="award-title">All JPL 3rd Team</div>
                 {% for res in p_vote.results if '3rd' in res.category %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>
         </div>
      {% endif %}
  </div>
  {% endfor %}

  {% if show_mvp and (top_players_a or top_players_b) %}
  <div class="mvp-section">
      <div class="mvp-header">
          <h2>WEEKLY MVP CANDIDATES</h2>
      </div>
      <div class="mvp-grid">
          {% for league_name, players in [('Aãƒªãƒ¼ã‚°', top_players_a), ('Bãƒªãƒ¼ã‚°', top_players_b)] %}
          <div class="mvp-column">
              <h3>{{ league_name }}</h3>
              {% for p in players %}
              <div class="mvp-card">
                  {% if p.player.team.logo_image %}
                    <img src="{{ p.player.team.logo_image }}" class="mvp-img">
                  {% endif %}
                  <div class="mvp-info">
                      <a href="{{ url_for('player_detail', player_id=p.player_id) }}" class="mvp-name">{{ p.player.name }} ({{ p.player.team.name }})</a>
                      <div class="mvp-stats">
                          <strong>{{ "%.1f"|format(p.avg_pts) }}</strong> PTS / 
                          <strong>{{ "%.1f"|format(p.avg_reb) }}</strong> REB / 
                          <strong>{{ "%.1f"|format(p.avg_ast) }}</strong> AST <br>
                          <strong>{{ "%.1f"|format(p.avg_stl) }}</strong> STL / 
                          <strong>{{ "%.1f"|format(p.avg_blk) }}</strong> BLK / 
                          <strong>{{ "%.1f"|format(p.fg_pct) }}</strong> FG% / 
                          <strong>{{ "%.1f"|format(p.three_pt_pct) }}</strong> 3P%
                      </div>
                  </div>
              </div>
              {% endfor %}
          </div>
          {% endfor %}
      </div>
  </div>
  {% endif %}

  {% if news_items %}
  <section class="news-section">
      <h2>ãƒªãƒ¼ã‚°ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›</h2>
      <div class="news-list">
          {% for item in news_items %}
          <div class="news-item">
              <h4>{{ item.title }}</h4>
              <small class="news-date">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }} (UTC)</small>
              <p class="news-content">{{ item.content | replace('\n', '<br>') | safe }}</p>
          </div>
          {% endfor %}
      </div>
  </section>
  {% endif %}
  
  <section class="tab-section">
    <div class="tab-navigation">
      <button class="tab-btn active" data-tab="overall">ç·åˆé †ä½</button>
      <button class="tab-btn" data-tab="a-league">Aãƒªãƒ¼ã‚°</button>
      <button class="tab-btn" data-tab="b-league">Bãƒªãƒ¼ã‚°</button>
      <button class="tab-btn" data-tab="leaders">ã‚¹ã‚¿ãƒƒãƒ„</button>
    </div>

    <div id="overall" class="tab-content active">
      <h3>ç·åˆé †ä½</h3>
      {% if overall_standings %}
      <div style="overflow-x: auto;"> <table class="stats-table">
          <thead><tr><th>é †ä½</th><th>ãƒãƒ¼ãƒ å</th><th>ãƒªãƒ¼ã‚°</th><th>å‹</th><th>æ•—</th><th>å‹ç‚¹</th><th>å¹³å‡å¾—ç‚¹</th><th>å¹³å‡å¤±ç‚¹</th><th>å¾—å¤±ç‚¹å·®</th></tr></thead>
          <tbody>
            {% for row in overall_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td>
              <td>{% if row.league == 'Aãƒªãƒ¼ã‚°' %}<span class="league-tag league-tag-a">Aãƒªãƒ¼ã‚°</span>{% elif row.league == 'Bãƒªãƒ¼ã‚°' %}<span class="league-tag league-tag-b">Bãƒªãƒ¼ã‚°</span>{% endif %}</td>
              <td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p>ãƒ‡ãƒ¼ã‚¿ãªã—</p>{% endif %}
    </div>
    <div id="a-league" class="tab-content">
       <h3>Aãƒªãƒ¼ã‚° é †ä½è¡¨</h3>
       {% if league_a_standings %}
       <div style="overflow-x: auto;">
         <table class="stats-table"><thead><tr><th>é †ä½</th><th>ãƒãƒ¼ãƒ å</th><th>å‹</th><th>æ•—</th><th>å‹ç‚¹</th><th>å¹³å‡å¾—ç‚¹</th><th>å¹³å‡å¤±ç‚¹</th><th>å¾—å¤±ç‚¹å·®</th></tr></thead><tbody>
             {% for row in league_a_standings %}<tr><td>{{ loop.index }}</td><td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td><td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td></tr>{% endfor %}
         </tbody></table></div>{% endif %}
    </div>
    <div id="b-league" class="tab-content">
        <h3>Bãƒªãƒ¼ã‚° é †ä½è¡¨</h3>
        {% if league_b_standings %}
        <div style="overflow-x: auto;">
          <table class="stats-table"><thead><tr><th>é †ä½</th><th>ãƒãƒ¼ãƒ å</th><th>å‹</th><th>æ•—</th><th>å‹ç‚¹</th><th>å¹³å‡å¾—ç‚¹</th><th>å¹³å‡å¤±ç‚¹</th><th>å¾—å¤±ç‚¹å·®</th></tr></thead><tbody>
              {% for row in league_b_standings %}<tr><td>{{ loop.index }}</td><td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td><td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td></tr>{% endfor %}
          </tbody></table></div>{% endif %}
    </div>
    <div id="leaders" class="tab-content">
      <div class="leader-header"><h3>ã‚¹ã‚¿ãƒƒãƒ„ãƒªãƒ¼ãƒ€ãƒ¼ (Top 5)</h3><a href="{{ url_for('stats_page') }}" class="button green">è©³ç´°</a></div><br>
      <div class="leader-grid">
        {% for category_name, players in leaders.items() %}
          <div class="leader-card"><h4>{{ category_name }}</h4><ol class="leader-list">{% for player in players %}{% if player[1] is not none and player[1] > 0 %}<li><span class="player-name"><a href="{{ url_for('player_detail', player_id=player[2]) }}">{{ player[0] }}</a></span><span class="player-stat">{{ "%.1f"|format(player[1]) }}</span></li>{% endif %}{% else %}<li>ãƒ‡ãƒ¼ã‚¿ãªã—</li>{% endfor %}</ol></div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="upcoming-section">
    <h2>ä»Šå¾Œã®è©¦åˆ</h2>
    <div class="upcoming-game-list">
      {% for game in upcoming_games %}
        <div class="upcoming-game-item">
          <div>
            <div class="game-date">{{ game.game_date }} {{ game.start_time }}</div>
            <div class="game-teams">
              {% if game.home_team.logo_image %}<img src="{{ game.home_team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=game.home_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.home_team.name }}</a> <span style="margin:0 10px;">vs</span> <a href="{{ url_for('team_detail', team_id=game.away_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.away_team.name }}</a>{% if game.away_team.logo_image %}<img src="{{ game.away_team.logo_image }}">{% endif %}
            </div>
          </div>
          <div class="game-link">{% if current_user.is_authenticated %}<a href="{{ url_for('edit_game', game_id=game.id) }}">çµæœå…¥åŠ›</a>{% else %}<span style="color:#666; font-size:0.8em;">è©¦åˆå‰</span>{% endif %}</div>
        </div>
      {% else %}<p>äºˆå®šã•ã‚Œã¦ã„ã‚‹è©¦åˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>{% endfor %}
    </div>
  </section>

  <div class="team-section">
    <h2>å‚åŠ ãƒãƒ¼ãƒ </h2>
    {% if all_teams %}
      <div class="team-list">
        {% for team in all_teams %}
          <a href="{{ url_for('team_detail', team_id=team.id) }}" class="team-card">
            {% if team.logo_image %}<img src="{{ team.logo_image }}">{% endif %}<h3>{{ team.name }}</h3>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
  });
</script>
{% endblock %}