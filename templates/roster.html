{% extends "layout.html" %}
{% block content %}
<style>
    /* --- ç®¡ç†ç”»é¢å…±é€šã‚¹ã‚¿ã‚¤ãƒ« --- */
    body { background-color: #f4f6f9; }
    .admin-container { max-width: 1100px; margin: 40px auto; padding: 0 15px; }
    
    .page-header {
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: 30px; border-bottom: 2px solid #e9ecef; padding-bottom: 15px;
    }
    .page-header h2 { margin: 0; color: #2c3e50; font-weight: 700; font-size: 1.8rem; }

    /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
    .admin-card {
        background: #ffffff; border-radius: 12px; border: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; overflow: hidden;
    }
    .card-header {
        background: #fff; border-bottom: 1px solid #f0f0f0; padding: 20px 25px;
        font-weight: 700; color: #34495e; font-size: 1.1rem; display: flex; justify-content: space-between; align-items: center;
    }
    .card-body { padding: 25px; }

    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
    .form-control {
        border-radius: 6px; border: 1px solid #ddd; padding: 10px; font-size: 0.95rem;
        background-color: #fdfdfd; width: 100%; box-sizing: border-box;
    }
    .form-control-sm { padding: 5px 10px; font-size: 0.85rem; }
    
    /* ãƒœã‚¿ãƒ³ */
    .btn {
        border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer;
        font-size: 0.9rem; transition: all 0.2s; display: inline-block; text-decoration: none;
    }
    .btn-primary { background: #007bff; color: white; }
    .btn-primary:hover { background: #0056b3; }
    .btn-success { background: #28a745; color: white; }
    .btn-warning { background: #ffc107; color: #333; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-sm { padding: 4px 10px; font-size: 0.8rem; }

    /* ãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰å›ºæœ‰ */
    .team-card-wrapper {
        border: 1px solid #eee; border-radius: 10px; margin-bottom: 20px;
        background: #fff; transition: box-shadow 0.2s;
    }
    .team-card-wrapper:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
    .team-card-wrapper.inactive { border-left: 5px solid #6c757d; background: #f8f9fa; }
    .team-card-wrapper.active { border-left: 5px solid #28a745; }

    .team-header {
        padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;
    }
    .team-info { display: flex; align-items: center; gap: 15px; }
    .team-logo { width: 50px; height: 50px; object-fit: contain; border-radius: 50%; border: 1px solid #ddd; background: #fff; }
    .team-name { margin: 0; font-size: 1.2rem; font-weight: bold; color: #333; }
    .team-league { background: #eee; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; color: #555; }
    
    .status-badge { padding: 3px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; margin-left: 10px; }
    .status-active { background: #d4edda; color: #155724; }
    .status-inactive { background: #e2e3e5; color: #383d41; }

    .team-actions { display: flex; gap: 5px; }

    /* é¸æ‰‹ãƒªã‚¹ãƒˆ */
    .player-list { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .player-list th { text-align: left; padding: 8px; font-size: 0.85rem; color: #777; border-bottom: 2px solid #eee; }
    .player-list td { padding: 8px; border-bottom: 1px solid #f5f5f5; vertical-align: middle; }
    .player-row.inactive td { color: #999; }
    
    /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼ˆè©³ç´°è¨­å®šï¼‰ */
    details summary { cursor: pointer; color: #007bff; font-size: 0.85rem; margin-top: 5px; outline: none; }
    .detail-box { background: #f8f9fa; padding: 10px; border-radius: 6px; margin-top: 5px; border: 1px solid #eee; }
</style>

<script>
    // å‰Šé™¤ç¢ºèªç”¨JavaScript
    function confirmDelete(event, message) {
        event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’ä¸€æ—¦æ­¢ã‚ã‚‹
        const userInput = prompt(message + "\n\nå®Ÿè¡Œã™ã‚‹ã«ã¯ 'delete' ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        
        if (userInput === 'delete') {
            // hidden inputã‚’ä½œæˆã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«è¿½åŠ 
            const form = event.target;
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'confirm_delete';
            hiddenInput.value = 'delete';
            form.appendChild(hiddenInput);
            form.submit(); // é€ä¿¡å†é–‹
        } else if (userInput !== null) {
            alert("å…¥åŠ›å†…å®¹ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚");
        }
    }
</script>

<div class="admin-container">
    <div class="page-header">
        <h2><span style="margin-right:10px;">ğŸ“‹</span>ãƒ­ã‚¹ã‚¿ãƒ¼ç®¡ç†</h2>
        <div>
            <a href="{{ url_for('admin_news') }}" class="btn btn-secondary btn-sm">ğŸ“¢ ãŠçŸ¥ã‚‰ã›ç®¡ç†ã¸</a>
        </div>
    </div>

    <div class="admin-card">
        <div class="card-header">
            <span>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç®¡ç†</span>
        </div>
        <div class="card-body">
            <form method="post" style="display:flex; gap:10px; align-items:center;">
                <input type="hidden" name="action" value="promote_user">
                <input type="text" name="username_to_promote" class="form-control" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" required>
                <button type="submit" class="btn btn-warning" onclick="return confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç®¡ç†è€…æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã‹ï¼Ÿ');">ç®¡ç†è€…ã¸æ˜‡æ ¼</button>
            </form>
        </div>
    </div>

    <div class="admin-card">
        <div class="card-header">
            <span>ğŸ€ æ–°è¦ãƒãƒ¼ãƒ ç™»éŒ²</span>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                <input type="hidden" name="action" value="add_team">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <label style="font-weight:bold; font-size:0.9rem;">ãƒãƒ¼ãƒ å</label>
                        <input type="text" name="team_name" class="form-control" required>
                    </div>
                    <div>
                        <label style="font-weight:bold; font-size:0.9rem;">æ‰€å±ãƒªãƒ¼ã‚°</label>
                        <select name="league" class="form-control">
                            <option value="Aãƒªãƒ¼ã‚°">Aãƒªãƒ¼ã‚°</option>
                            <option value="Bãƒªãƒ¼ã‚°">Bãƒªãƒ¼ã‚°</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-weight:bold; font-size:0.9rem;">ãƒ­ã‚´ç”»åƒ</label>
                        <input type="file" name="logo_image" class="form-control" style="padding:6px;">
                    </div>
                </div>
                
                <details style="margin-top:15px;">
                    <summary>åˆæœŸãƒ¡ãƒ³ãƒãƒ¼ã‚’ä¸€æ‹¬ç™»éŒ²ã™ã‚‹ (ä»»æ„: æœ€å¤§10äºº)</summary>
                    <div class="detail-box" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap:10px;">
                        {% for i in range(1, 11) %}
                        <input type="text" name="player_name_{{ i }}" class="form-control form-control-sm" placeholder="é¸æ‰‹ {{ i }}">
                        {% endfor %}
                    </div>
                </details>

                <div style="margin-top:15px; text-align:right;">
                    <button type="submit" class="btn btn-primary">ãƒãƒ¼ãƒ ã‚’ä½œæˆ</button>
                </div>
            </form>
        </div>
    </div>

    <h3 style="margin-bottom:20px; color:#2c3e50;">ç™»éŒ²ãƒãƒ¼ãƒ ä¸€è¦§</h3>
    
    {% for team in teams %}
    <div class="team-card-wrapper {% if team.is_active %}active{% else %}inactive{% endif %}">
        <div class="team-header">
            <div class="team-info">
                {% if team.logo_image %}
                    <img src="{{ team.logo_image }}" class="team-logo">
                {% else %}
                    <div class="team-logo" style="display:flex; align-items:center; justify-content:center; background:#eee; font-size:1.5rem;">ğŸ›¡ï¸</div>
                {% endif %}
                <div>
                    <h4 class="team-name">
                        {{ team.name }}
                        <span class="team-league">{{ team.league }}</span>
                        {% if team.is_active %}
                            <span class="status-badge status-active">æ´»å‹•ä¸­</span>
                        {% else %}
                            <span class="status-badge status-inactive">å»ƒéƒ¨(éè¡¨ç¤º)</span>
                        {% endif %}
                    </h4>
                </div>
            </div>
            
            <div class="team-actions">
                <details style="display:inline-block;">
                    <summary class="btn btn-sm btn-secondary">ãƒ­ã‚´å¤‰æ›´</summary>
                    <div style="position:absolute; right:20px; background:white; border:1px solid #ccc; padding:10px; border-radius:5px; z-index:100; box-shadow:0 5px 10px rgba(0,0,0,0.1);">
                        <form method="post" enctype="multipart/form-data">
                            <input type="hidden" name="action" value="update_logo">
                            <input type="hidden" name="team_id" value="{{ team.id }}">
                            <input type="file" name="logo_image" class="form-control-sm" required>
                            <button type="submit" class="btn btn-sm btn-primary" style="margin-top:5px;">æ›´æ–°</button>
                        </form>
                    </div>
                </details>

                <form method="post" style="display:inline;">
                    <input type="hidden" name="action" value="toggle_team_active">
                    <input type="hidden" name="team_id" value="{{ team.id }}">
                    <button type="submit" class="btn btn-sm {% if team.is_active %}btn-warning{% else %}btn-success{% endif %}">
                        {% if team.is_active %}å»ƒéƒ¨ã«ã™ã‚‹{% else %}æ´»å‹•å†é–‹{% endif %}
                    </button>
                </form>

                <form method="post" style="display:inline;" onsubmit="confirmDelete(event, 'ã€è­¦å‘Šã€‘\nã“ã®ãƒãƒ¼ãƒ ã€Œ{{ team.name }}ã€ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\néå»ã®å…¨è©¦åˆè¨˜éŒ²ã€ã‚¹ã‚¿ãƒƒãƒ„ã‚‚æ°¸ä¹…ã«æ¶ˆæ»…ã—ã¾ã™ã€‚');">
                    <input type="hidden" name="action" value="delete_team">
                    <input type="hidden" name="team_id" value="{{ team.id }}">
                    <button type="submit" class="btn btn-sm btn-danger">å®Œå…¨å‰Šé™¤</button>
                </form>
            </div>
        </div>

        <div class="card-body" style="padding-top:10px;">
            <form method="post" style="display:flex; gap:10px; margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:6px;">
                <input type="hidden" name="action" value="add_player">
                <input type="hidden" name="team_id" value="{{ team.id }}">
                <input type="text" name="player_name" class="form-control form-control-sm" placeholder="æ–°è¦é¸æ‰‹å" required>
                <button type="submit" class="btn btn-sm btn-primary" style="white-space:nowrap;">é¸æ‰‹è¿½åŠ </button>
            </form>

            {% if team.players %}
            <table class="player-list">
                <thead>
                    <tr>
                        <th style="width: 30%;">åå‰</th>
                        <th style="width: 15%;">çŠ¶æ…‹</th>
                        <th style="width: 55%;">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player in team.players %}
                    <tr class="player-row {% if not player.is_active %}inactive{% endif %}">
                        <td>
                            <form method="post" style="display:flex; gap:5px;">
                                <input type="hidden" name="action" value="edit_player">
                                <input type="hidden" name="player_id" value="{{ player.id }}">
                                <input type="text" name="new_name" value="{{ player.name }}" class="form-control form-control-sm" style="width:120px;">
                                <button type="submit" class="btn btn-sm btn-secondary" title="åå‰å¤‰æ›´">ğŸ–Šï¸</button>
                            </form>
                        </td>
                        <td>
                            {% if player.is_active %}
                                <span class="status-badge status-active">ç¾å½¹</span>
                            {% else %}
                                <span class="status-badge status-inactive">å¼•é€€</span>
                            {% endif %}
                        </td>
                        <td style="display:flex; gap:5px; align-items:center;">
                            <details>
                                <summary style="margin:0;" class="btn btn-sm btn-secondary">ç§»ç±</summary>
                                <div style="position:absolute; background:white; padding:10px; border:1px solid #ccc; z-index:50;">
                                    <form method="post">
                                        <input type="hidden" name="action" value="transfer_player">
                                        <input type="hidden" name="player_id" value="{{ player.id }}">
                                        <select name="new_team_id" class="form-control form-control-sm" style="margin-bottom:5px;">
                                            {% for t in teams %}
                                            {% if t.id != team.id %}
                                            <option value="{{ t.id }}">{{ t.name }}</option>
                                            {% endif %}
                                            {% endfor %}
                                        </select>
                                        <button type="submit" class="btn btn-sm btn-primary">ç§»ç±å®Ÿè¡Œ</button>
                                    </form>
                                </div>
                            </details>

                            <form method="post">
                                <input type="hidden" name="action" value="toggle_player_active">
                                <input type="hidden" name="player_id" value="{{ player.id }}">
                                <button type="submit" class="btn btn-sm {% if player.is_active %}btn-warning{% else %}btn-success{% endif %}">
                                    {% if player.is_active %}å¼•é€€{% else %}å¾©å¸°{% endif %}
                                </button>
                            </form>

                            <form method="post" onsubmit="confirmDelete(event, 'é¸æ‰‹ã€Œ{{ player.name }}ã€ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\néå»ã®ã‚¹ã‚¿ãƒƒãƒ„ã‚‚æ¶ˆæ»…ã—ã¾ã™ã€‚');">
                                <input type="hidden" name="action" value="delete_player">
                                <input type="hidden" name="player_id" value="{{ player.id }}">
                                <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ï¸</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
                <p style="color:#999; font-size:0.9rem; text-align:center;">æ‰€å±é¸æ‰‹ã¯ã„ã¾ã›ã‚“</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}