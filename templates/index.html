{% extends "layout.html" %}
{% block content %}
<style>
  /* --- „Éö„Éº„Ç∏ÂÖ®‰Ωì„ÅÆ„É©„ÉÉ„Éë„Éº --- */
  .homepage-wrapper {
    position: relative; border-radius: 8px; overflow: hidden; color: #ffffff; padding: 25px; min-height: 80vh;
  }
  .homepage-wrapper::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=1400&q=80');
    background-size: cover; background-position: center; background-attachment: fixed; z-index: -2;
  }
  .homepage-wrapper::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0, 0, 0, 0.75); z-index: -1;
  }
  .homepage-wrapper h1 { 
      border-bottom: 2px solid #007bff; padding-bottom: 10px; 
      text-shadow: 1px 1px 4px rgba(0,0,0,0.8); font-size: 2.2rem; margin-top: 0;
  }
  .homepage-wrapper h3 { color: #eee; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }

  /* Ë¶ãÂá∫„Åó„ÅÆ„Çπ„Çø„Ç§„É´ */
  .mvp-header h2, .news-section h2, .award-header h2, .team-section h2, .upcoming-section h2 {
      background-color: #002244; color: #ffd700; padding: 15px; border-radius: 8px; 
      text-align: center; border-bottom: none; margin-bottom: 20px; 
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); font-size: 1.5rem;
  }

  /* ÊäïÁ•®„Éê„Éä„Éº */
  .vote-banner { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #333; padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4); border: 2px solid #fff; }
  .vote-banner h3 { color: #000; font-weight: 900; margin-top: 0; text-shadow: none; font-size: 1.3em; }
  .vote-btn { background-color: #333; color: #fff; padding: 10px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 10px; transition: transform 0.2s, background-color 0.2s; border: 2px solid #333; font-size: 0.9rem; }
  .vote-btn:hover { background-color: #fff; color: #333; transform: scale(1.05); text-decoration: none; }

  /* „Ç¢„ÉØ„Éº„ÉâÁµêÊûú„Çª„ÇØ„Ç∑„Éß„É≥ */
  .award-section { margin-bottom: 40px; }
  .award-grid { display: grid; gap: 15px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
  .award-card { background: rgba(255,255,255,0.95); color: #333; border-radius: 8px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
  .award-title { font-size: 1.1em; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; text-align: center; color: #004a99; text-shadow: none; }
  .award-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #ccc; align-items: center; font-size: 0.9rem; }
  .award-pos { font-weight: bold; width: 50px; color: #555; font-size: 0.85rem; } .award-player { flex-grow: 1; font-weight: bold; } .award-score { font-size: 0.85em; color: #666; }

  /* MVP„Çª„ÇØ„Ç∑„Éß„É≥ (Tabs) */
  .mvp-section { margin-bottom: 30px; }
  .mvp-tab-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
  .mvp-tab-btn { 
      padding: 8px 20px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); 
      color: #fff; cursor: pointer; border-radius: 20px; font-weight: bold; transition: 0.3s; font-size: 0.9rem;
  }
  .mvp-tab-btn.active { background: #ffd700; color: #000; border-color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
  
  .mvp-content { display: none; }
  .mvp-content.active { display: block; animation: fadeIn 0.5s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .mvp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
  .mvp-column h3 { text-align: center; background-color: rgba(0,0,0,0.5); color: #fff; padding: 5px; border-radius: 6px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.2); font-size: 1em; }
  .mvp-card { background-color: rgba(255,255,255,0.95); color: #333; border-radius: 6px; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); height: auto; border-left: 4px solid #004a99; }
  .mvp-img { width: 40px; height: 40px; object-fit: contain; margin-right: 10px; border-radius: 50%; background: #fff; border: 1px solid #ddd; }
  .mvp-info { flex-grow: 1; min-width: 0; } 
  .mvp-name { font-weight: bold; font-size: 0.95em; display: block; color: #004a99; text-decoration: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  
  /* MVP„Çπ„Çø„ÉÉ„ÉÑË™øÊï¥ */
  .mvp-stats { font-size: 0.75em; color: #555; margin-top: 3px; line-height: 1.3; } 
  .mvp-stats strong { color: #222; font-size: 1.1em; margin-right: 1px; }
  .mvp-stats-row { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .mvp-score { font-size: 0.8em; color: #d63384; font-weight: bold; text-align: right; min-width: 40px; margin-left: 5px; }

  /* „ÉÜ„Éº„Éñ„É´ÔºàÈ†Ü‰ΩçË°®Ôºâ„ÅÆ„Çπ„Éû„ÉõÂØæÂøú */
  .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fff;
  }
  .stats-table {
      width: 100%; border-collapse: separate; border-spacing: 0;
      font-size: 0.9rem; white-space: nowrap; color: #333;
  }
  .stats-table th, .stats-table td {
      padding: 10px 12px; border-bottom: 1px solid #eee; border-right: 1px solid #f0f0f0; text-align: center;
  }
  .stats-table th {
      background: #343a40; color: #fff; font-weight: bold;
      position: sticky; top: 0; z-index: 10; border-right-color: #555;
  }
  .stats-table th:nth-child(1), .stats-table td:nth-child(1) {
      position: sticky; left: 0; z-index: 11;
      border-right: 1px solid #ddd; text-align: center;
      background-color: #fff; width: 50px; min-width: 50px;
  }
  .stats-table th:nth-child(2), .stats-table td:nth-child(2) {
      position: sticky; left: 50px; z-index: 11;
      border-right: 2px solid #ddd; text-align: left;
      background-color: #fff; min-width: 140px;
  }
  .stats-table th:nth-child(1), .stats-table th:nth-child(2) { background: #343a40; z-index: 20; color: #fff; }
  .stats-table td:nth-child(1) { font-weight: bold; color: #666; }
  .stats-table td:nth-child(2) { font-weight: bold; color: #004a99; }
  .stats-table tbody tr:nth-child(even) td { background-color: #f8f9fa; }
  .stats-table tbody tr:nth-child(even) td:nth-child(1),
  .stats-table tbody tr:nth-child(even) td:nth-child(2) { background-color: #f8f9fa; }

  .tab-content { display: none; background: rgba(255,255,255,0.9); border: 1px solid #fff; padding: 15px; border-radius: 0 6px 6px 6px; color: #333; } .tab-content.active { display: block; }
  
  /* „Çπ„Çø„ÉÉ„ÉÑ„É™„Éº„ÉÄ„Éº */
  .leader-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
  .leader-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: #333; }
  .leader-card h4 { margin-top: 0; border-bottom: 2px solid #004a99; padding-bottom: 5px; color: #004a99; font-size: 1em; text-align: center; text-shadow: none; }
  .leader-list { padding-left: 20px; margin: 0; }
  .leader-list li { margin-bottom: 5px; display: flex; justify-content: space-between; font-size: 0.9em; border-bottom: 1px dashed #eee; padding-bottom: 3px; }
  
  /* „Çø„Éñ„Éú„Çø„É≥ (È†Ü‰ΩçË°®Áî®) */
  .tab-navigation { display: flex; gap: 3px; margin-bottom: -1px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .tab-btn { padding: 10px 15px; background: rgba(0,0,0,0.6); color: #ccc; border: 1px solid #555; border-bottom: none; border-radius: 6px 6px 0 0; cursor: pointer; font-weight: bold; font-size: 0.9rem; white-space: nowrap; }
  .tab-btn.active { background: rgba(255,255,255,0.9); color: #000000; border-color: #fff; border-bottom: 2px solid #007bff; } 
  
  .team-cell { display: flex; align-items: center; gap: 8px; } .team-cell img { height: 20px; width: 20px; object-fit: contain; }
  .league-tag { font-size: 11px; padding: 2px 6px; border-radius: 8px; font-weight: bold; }
  .league-tag-a { background: #ffebee; color: #c62828; } .league-tag-b { background: #e3f2fd; color: #1565c0; }
  
  .upcoming-game-item { background: rgba(255,255,255,0.9); border-radius: 8px; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; color: #333; flex-wrap: wrap; gap: 10px; }
  .game-teams { font-weight: bold; font-size: 1rem; } .game-teams img { height: 18px; margin: 0 4px; vertical-align: middle; }
  .game-link a { background: #007bff; color: #fff; padding: 6px 10px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; }
  
  /* „ÉÅ„Éº„É†„Ç´„Éº„Éâ */
  .team-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
  .team-card { background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px; text-align: center; color: #333333; text-decoration: none; }
  .team-card:hover { transform: translateY(-5px); } .team-card img { width: 60px; margin-bottom: 10px; }
  .team-card h3 { margin: 0; color: #000000; font-size: 1rem; }

  .news-section { background-color: rgba(0, 0, 0, 0.6); border: 1px solid #555; border-radius: 8px; padding: 15px; margin-bottom: 30px; }
  .news-item { border-bottom: 1px solid #777; padding: 15px 0; } .news-item:last-child { border-bottom: none; }
  .news-item h4 { margin: 0 0 5px; color: #4dabf7; font-size: 1.1em; } .news-date { color: #ccc; font-size: 0.85em; } .news-content { margin: 0; line-height: 1.6; font-size: 0.95em; }

  /* „Éñ„É©„Ç±„ÉÉ„ÉàÁî®„Çπ„Çø„Ç§„É´ */
  .bracket-container { display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 20px 0; background: rgba(0,0,0,0.3); border-radius: 8px; margin-bottom: 40px; }
  .bracket-content-wrapper { display: flex; min-width: 900px; justify-content: space-between; padding: 0 10px; margin: 0 auto; }
  .bracket-league { display: flex; }
  .bracket-round { display: flex; flex-direction: column; justify-content: space-around; width: 140px; margin: 0 5px; }
  .match-card { background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 5px; margin: 8px 0; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-size: 0.8em; color: #333; }
  .match-date { font-size: 0.75em; color: #666; text-align: center; border-bottom: 1px solid #eee; margin-bottom: 4px; }
  .match-team { display: flex; justify-content: space-between; padding: 2px 5px; }
  .team-winner { font-weight: 900; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); color: #e65100; border-left: 4px solid #ff9800; }
  .team-score { font-weight: bold; margin-left: 5px; }
  .grand-final { width: 160px; } .grand-final .match-card { border: 2px solid #ffd700; transform: scale(1.05); }
  .champion-area { text-align: center; margin-top: 10px; font-weight: bold; color: #ffd700; font-size: 0.9rem; }
  .news-image { width: 100%; max-height: 300px; object-fit: contain; background-color: #000; border-radius: 5px; margin-top: 10px; border: 1px solid #555; }

  /* „Éã„É•„Éº„ÇπÈÄüÂ†±„Éê„Éº (Ticker) */
  .news-ticker-container {
      width: 100%; background-color: #cc0000; color: #fff; overflow: hidden; position: relative; height: 40px;
      display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); margin-bottom: 0; z-index: 100;
  }
  .ticker-label {
      background-color: #ffcc00; color: #000; padding: 0 15px; height: 100%; display: flex; align-items: center;
      font-weight: 900; font-style: italic; z-index: 2; box-shadow: 2px 0 5px rgba(0,0,0,0.2); white-space: nowrap;
  }
  .ticker-wrap { width: 100%; overflow: hidden; white-space: nowrap; }
  .ticker-move {
      display: inline-block; white-space: nowrap; padding-left: 100%;
      animation: ticker-anim 25s linear infinite; font-weight: bold; font-size: 1.1rem; letter-spacing: 1px;
  }
  @keyframes ticker-anim { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
  .news-ticker-container:hover .ticker-move { animation-play-state: paused; }

  /* üì± „Çπ„Éû„ÉõÂêë„Åë„É¨„Çπ„Éù„É≥„Ç∑„ÉñË™øÊï¥ */
  @media (max-width: 768px) {
      .homepage-wrapper { padding: 15px 10px; }
      .homepage-wrapper h1 { font-size: 1.5rem; }
      .mvp-header h2, .news-section h2, .award-header h2, .team-section h2, .upcoming-section h2 { font-size: 1.2rem; padding: 10px; }
      .stats-table { font-size: 0.8rem; }
      .stats-table th, .stats-table td { padding: 8px 6px; }
      .stats-table th:nth-child(1), .stats-table td:nth-child(1) { width: 40px; min-width: 40px; }
      .stats-table th:nth-child(2), .stats-table td:nth-child(2) { left: 40px; min-width: 120px; max-width: 130px; overflow: hidden; text-overflow: ellipsis; }
      
      .tab-btn { padding: 8px 12px; font-size: 0.8rem; }
      .mvp-grid { grid-template-columns: 1fr; }
      .mvp-card { padding: 8px; }
      .mvp-name { font-size: 0.9rem; }
      .award-grid { grid-template-columns: 1fr; }
      .team-list { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
      .team-card { padding: 10px; } .team-card img { width: 50px; } .team-card h3 { font-size: 0.85rem; }
      .bracket-container { padding: 10px 0; }
  }
</style>

{% if show_ticker and ticker_content %}
<div class="news-ticker-container">
    <div class="ticker-label">BREAKING NEWS</div>
    <div class="ticker-wrap">
        <div class="ticker-move">{{ ticker_content }}</div>
    </div>
</div>
{% endif %}

<div class="homepage-wrapper">
  
  <div style="text-align: right; margin-bottom: 15px;">
      <form action="{{ url_for('index') }}" method="get" style="display:inline;">
          <select name="season_id" onchange="this.form.submit()" style="padding: 5px; border-radius: 4px; font-size: 0.9rem;">
              {% for s in all_seasons %}
              <option value="{{ s.id }}" {% if s.id == view_season_id %}selected{% endif %}>
                  {{ s.name }} {% if s.is_current %}(ÁèæÂú®){% endif %}
              </option>
              {% endfor %}
          </select>
      </form>
  </div>

  <h1>NBA2K JPL</h1>

  {% if active_votes %}
  <div class="vote-banner">
      <h3>üì¢ ÁèæÂú®„ÄÅÊäïÁ•®Âèó‰ªò‰∏≠ÔºÅ</h3>
      <p style="margin: 5px 0; font-size: 0.9rem;">„ÅÇ„Å™„Åü„ÅÆ1Á•®„Åå„É™„Éº„Ç∞„ÇíÁõõ„Çä‰∏ä„Åí„Åæ„Åô„ÄÇ</p>
      <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
          {% for vote in active_votes %}
              <a href="{{ url_for('vote_page', config_id=vote.id) }}" class="vote-btn">
                  {{ vote.title }} „Å´ÊäïÁ•® üó≥Ô∏è
              </a>
          {% endfor %}
      </div>
  </div>
  {% endif %}

  {% if latest_result %}
  <div class="latest-result-banner">
      <p style="margin: 0; font-size: 0.9rem;">
          ÁµêÊûú: 
          {{ latest_result.home_team.name }}
          <a href="{{ url_for('game_result', game_id=latest_result.id) }}">
              {{ latest_result.home_score }} - {{ latest_result.away_score }}
          </a>
          {{ latest_result.away_team.name }}
      </p>
  </div>
  {% endif %}

  {% for p_vote in published_votes %}
  <div class="award-section">
      <div class="award-header">
          <h2>üèÜ {{ p_vote.title }} ÁµêÊûú</h2>
      </div>
      
      {% if p_vote.vote_type == 'weekly' or p_vote.vote_type == 'monthly' %}
         <div class="award-card" style="text-align: center;">
             <div style="display:flex; flex-wrap:wrap; justify-content:space-around; gap:20px;">
                {% for res in p_vote.results if res.rank == 1 %}
                    <div style="flex:1; min-width: 200px;">
                        <h3 style="color:#004a99; margin-top:0; font-size: 1.1em;">
                            {{ res.category.split(' ')[-2] }}„É™„Éº„Ç∞ MVP
                        </h3>
                        <p style="font-size:1.3em; font-weight:bold; margin: 5px 0;">
                            üéâ {{ res.player.name }} <br><small style="font-size:0.6em; color:#666;">({{ res.player.team.name }})</small>
                        </p>
                        <p style="font-size:0.9em; font-weight:bold; color:#d63384;">{{ res.score }}Á•®</p>
                    </div>
                {% endfor %}
            </div>
         </div>
      
      {% elif p_vote.vote_type == 'all_star' %}
         <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:20px;">
             <div class="award-card" style="border-top: 5px solid #c62828;">
                 <h3 style="text-align:center; color:#c62828; margin-top:0;">A„É™„Éº„Ç∞</h3>
                 {% for res in p_vote.results if 'A„É™„Éº„Ç∞' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('A„É™„Éº„Ç∞ ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}Á•®</span>
                     </div>
                 {% endfor %}
             </div>
             <div class="award-card" style="border-top: 5px solid #1565c0;">
                 <h3 style="text-align:center; color:#1565c0; margin-top:0;">B„É™„Éº„Ç∞</h3>
                 {% for res in p_vote.results if 'B„É™„Éº„Ç∞' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('B„É™„Éº„Ç∞ ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}Á•®</span>
                     </div>
                 {% endfor %}
             </div>
         </div>

      {% elif p_vote.vote_type == 'awards' %}
         <div class="award-grid">
             <div class="award-card">
                 <div class="award-title">ÂÄã‰∫∫Ë≥û</div>
                 {% for res in p_vote.results if res.category in ['MVP', 'DPOY'] and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos" style="width:60px;">{{ res.category }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>

             {% for team_rank in ['1st', '2nd', '3rd'] %}
             <div class="award-card">
                 <div class="award-title">All JPL {{ team_rank }} Team</div>
                 {% for res in p_vote.results if team_rank in res.category %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>
             {% endfor %}
         </div>
      {% endif %}
  </div>
  {% endfor %}

  {% if show_mvp %}
  <div class="mvp-section">
      <div class="mvp-header">
          <h2>MVP CANDIDATES</h2>
          <div class="mvp-tab-nav">
              <button class="mvp-tab-btn active" onclick="switchMvpTab('weekly')">Weekly</button>
              <button class="mvp-tab-btn" onclick="switchMvpTab('monthly')">Monthly</button>
          </div>
      </div>

      <div id="mvp-weekly" class="mvp-content active">
          <div class="mvp-grid">
              {% for league_name, players in [('A„É™„Éº„Ç∞', weekly_candidates_a), ('B„É™„Éº„Ç∞', weekly_candidates_b)] %}
              <div class="mvp-column">
                  <h3>{{ league_name }}</h3>
                  {% for p in players %}
                  <div class="mvp-card">
                      {% if p.player.team.logo_image %}
                        <img src="{{ p.player.team.logo_image }}" class="mvp-img">
                      {% endif %}
                      <div class="mvp-info">
                          <a href="{{ url_for('player_detail', player_id=p.player_id) }}" class="mvp-name">{{ p.player.name }} <br><small style="color:#666; font-weight:normal;">{{ p.player.team.name }}</small></a>
                          
                          <div class="mvp-stats">
                              <div class="mvp-stats-row"><strong>{{ "%.1f"|format(p.avg_pts) }}</strong> PTS / <strong>{{ "%.1f"|format(p.avg_reb) }}</strong> REB / <strong>{{ "%.1f"|format(p.avg_ast) }}</strong> AST</div>
                              <div class="mvp-stats-row" style="margin-top:2px;"><strong>{{ "%.1f"|format(p.avg_stl) }}</strong> STL / <strong>{{ "%.1f"|format(p.avg_blk) }}</strong> BLK / <strong>{{ "%.1f"|format(p.fg_pct) }}</strong>% FG / <strong>{{ "%.1f"|format(p.three_pt_pct) }}</strong>% 3P</div>
                              <div class="mvp-stats-row" style="margin-top:2px; color:#d63384; font-weight:bold;">
                                  Team Record: {{ p.team_wins }}Âãù {{ p.team_losses }}Êïó
                              </div>
                          </div>

                      </div>
                      <div class="mvp-score">
                          {{ "%.1f"|format(p.score) }}<br><small>IMP</small>
                      </div>
                  </div>
                  {% else %}
                    <p style="text-align:center; color:#ccc; font-size:0.9rem;">No Candidates</p>
                  {% endfor %}
              </div>
              {% endfor %}
          </div>
      </div>

      <div id="mvp-monthly" class="mvp-content">
          <div class="mvp-grid">
              {% for league_name, players in [('A„É™„Éº„Ç∞', monthly_candidates_a), ('B„É™„Éº„Ç∞', monthly_candidates_b)] %}
              <div class="mvp-column">
                  <h3>{{ league_name }}</h3>
                  {% for p in players %}
                  <div class="mvp-card" style="border-left-color: #6610f2;">
                      {% if p.player.team.logo_image %}
                        <img src="{{ p.player.team.logo_image }}" class="mvp-img">
                      {% endif %}
                      <div class="mvp-info">
                          <a href="{{ url_for('player_detail', player_id=p.player_id) }}" class="mvp-name" style="color: #6610f2;">{{ p.player.name }} <br><small style="color:#666; font-weight:normal;">{{ p.player.team.name }}</small></a>
                          
                          <div class="mvp-stats">
                              <div class="mvp-stats-row"><strong>{{ "%.1f"|format(p.avg_pts) }}</strong> PTS / <strong>{{ "%.1f"|format(p.avg_reb) }}</strong> REB / <strong>{{ "%.1f"|format(p.avg_ast) }}</strong> AST</div>
                              <div class="mvp-stats-row" style="margin-top:2px;"><strong>{{ "%.1f"|format(p.avg_stl) }}</strong> STL / <strong>{{ "%.1f"|format(p.avg_blk) }}</strong> BLK / <strong>{{ "%.1f"|format(p.fg_pct) }}</strong>% FG / <strong>{{ "%.1f"|format(p.three_pt_pct) }}</strong>% 3P</div>
                              <div class="mvp-stats-row" style="margin-top:2px; color:#6610f2; font-weight:bold;">
                                  Team Record: {{ p.team_wins }}Âãù {{ p.team_losses }}Êïó
                              </div>
                          </div>

                      </div>
                      <div class="mvp-score" style="color: #6610f2;">
                          {{ "%.1f"|format(p.score) }}<br><small>IMP</small>
                      </div>
                  </div>
                  {% else %}
                    <p style="text-align:center; color:#ccc; font-size:0.9rem;">No Candidates</p>
                  {% endfor %}
              </div>
              {% endfor %}
          </div>
      </div>
  </div>
  {% endif %}

  {% if news_items %}
  <section class="news-section">
      <h2>„É™„Éº„Ç∞„Åã„Çâ„ÅÆ„ÅäÁü•„Çâ„Åõ</h2>
      <div class="news-list">
          {% for item in news_items %}
          <div class="news-item">
              <h4>{{ item.title }}</h4>
              <small class="news-date">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
              <p class="news-content">{{ item.content | replace('\n', '<br>') | safe }}</p>
              
              {% if item.image_url %}
                  <div style="margin-top:10px;">
                      <img src="{{ item.image_url }}" alt="News Image" class="news-image">
                  </div>
              {% endif %}
          </div>
          {% endfor %}
      </div>
  </section>
  {% endif %}
  
  <section class="tab-section">
    <div class="tab-navigation">
      <button class="tab-btn active" data-tab="overall">Á∑èÂêàÈ†Ü‰Ωç</button>
      <button class="tab-btn" data-tab="a-league">A„É™„Éº„Ç∞</button>
      <button class="tab-btn" data-tab="b-league">B„É™„Éº„Ç∞</button>
      <button class="tab-btn" data-tab="leaders">„Çπ„Çø„ÉÉ„ÉÑ</button>
    </div>

    <div id="overall" class="tab-content active">
      <h3 style="color:#000;">Á∑èÂêàÈ†Ü‰Ωç</h3>
      {% if overall_standings %}
      <div class="table-responsive"> 
        <table class="stats-table">
          <thead>
            <tr>
              <th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>„É™„Éº„Ç∞</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th>
              <th>ÂæóÁÇπ</th><th>Â§±ÁÇπ</th><th>ÂæóÂ§±Â∑Æ</th><th>Áõ¥Ëøë5Ë©¶Âêà</th><th>ÈÄ£Âãù/Êïó</th>
            </tr>
          </thead>
          <tbody>
            {% for row in overall_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">
                {% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}
                <a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a>
              </td>
              <td>
                {% if row.league == 'A„É™„Éº„Ç∞' %}<span class="league-tag league-tag-a">A„É™„Éº„Ç∞</span>
                {% elif row.league == 'B„É™„Éº„Ç∞' %}<span class="league-tag league-tag-b">B„É™„Éº„Ç∞</span>{% endif %}
              </td>
              <td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td>
              <td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td>
              <td>{{ row.form }}</td><td>{{ row.streak }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p style="color:#333;">„Éá„Éº„Çø„Å™„Åó</p>{% endif %}
    </div>

    <div id="a-league" class="tab-content">
       <h3 style="color:#000;">A„É™„Éº„Ç∞ È†Ü‰ΩçË°®</h3>
       {% if league_a_standings %}
       <div class="table-responsive">
         <table class="stats-table">
           <thead>
             <tr><th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th><th>ÂæóÁÇπ</th><th>Â§±ÁÇπ</th><th>ÂæóÂ§±Â∑Æ</th><th>Áõ¥Ëøë5Ë©¶Âêà</th><th>ÈÄ£Âãù/Êïó</th></tr>
           </thead>
           <tbody>
             {% for row in league_a_standings %}
             <tr>
               <td>{{ loop.index }}</td>
               <td class="team-cell">
                 {% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}
                 <a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a>
               </td>
               <td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td>
               <td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td>
               <td>{{ row.form }}</td><td>{{ row.streak }}</td>
             </tr>
             {% endfor %}
           </tbody>
         </table>
       </div>
       {% endif %}
    </div>

    <div id="b-league" class="tab-content">
        <h3 style="color:#000;">B„É™„Éº„Ç∞ È†Ü‰ΩçË°®</h3>
        {% if league_b_standings %}
        <div class="table-responsive">
          <table class="stats-table">
            <thead>
              <tr><th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th><th>ÂæóÁÇπ</th><th>Â§±ÁÇπ</th><th>ÂæóÂ§±Â∑Æ</th><th>Áõ¥Ëøë5Ë©¶Âêà</th><th>ÈÄ£Âãù/Êïó</th></tr>
            </thead>
            <tbody>
              {% for row in league_b_standings %}
              <tr>
                <td>{{ loop.index }}</td>
                <td class="team-cell">
                  {% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}
                  <a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a>
                </td>
                <td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td>
                <td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td>
                <td>{{ row.form }}</td><td>{{ row.streak }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% endif %}
    </div>

    <div id="leaders" class="tab-content">
      <div class="leader-header"><h3 style="color:#000;">„Çπ„Çø„ÉÉ„ÉÑ„É™„Éº„ÉÄ„Éº (Top 5)</h3><a href="{{ url_for('stats_page') }}" class="button green small">Ë©≥Á¥∞„Å∏</a></div><br>
      <div class="leader-grid">
        {% for category_name, players in leaders.items() %}
          <div class="leader-card"><h4>{{ category_name }}</h4><ol class="leader-list">{% for player in players %}{% if player[1] is not none and player[1] > 0 %}<li><span class="player-name"><a href="{{ url_for('player_detail', player_id=player[2]) }}">{{ player[0] }}</a></span><span class="player-stat">{{ "%.1f"|format(player[1]) }}</span></li>{% endif %}{% else %}<li>„Éá„Éº„Çø„Å™„Åó</li>{% endfor %}</ol></div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="upcoming-section">
    <h2>‰ªäÂæå„ÅÆË©¶Âêà</h2>
    <div class="upcoming-game-list">
      {% for game in upcoming_games %}
        <div class="upcoming-game-item">
          <div>
            <div class="game-date">{{ game.game_date }} {{ game.start_time }}</div>
            <div class="game-teams">
              {% if game.home_team.logo_image %}<img src="{{ game.home_team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=game.home_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.home_team.name }}</a> <span style="margin:0 5px;">vs</span> <a href="{{ url_for('team_detail', team_id=game.away_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.away_team.name }}</a>{% if game.away_team.logo_image %}<img src="{{ game.away_team.logo_image }}">{% endif %}
            </div>
          </div>
          <div class="game-link">{% if current_user.is_authenticated %}<a href="{{ url_for('edit_game', game_id=game.id) }}">ÁµêÊûúÂÖ•Âäõ</a>{% else %}<span style="color:#666; font-size:0.8em;">Ë©¶ÂêàÂâç</span>{% endif %}</div>
        </div>
      {% else %}<p>‰∫àÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãË©¶Âêà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>{% endfor %}
    </div>
  </section>

  {% if show_playoff %}
  <div class="upcoming-section">
    <h2>PLAYOFF BRACKET</h2>
    {% if current_user.is_admin %}
    <div style="text-align:center; margin-bottom:10px;">
        <a href="{{ url_for('admin_playoff') }}" class="button primary small">Á∑®ÈõÜ</a>
    </div>
    {% endif %}
    <div class="bracket-container">
        <div class="bracket-content-wrapper">
            <div class="bracket-league">
                <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">A - Round 1</h5>
                    {% for m in bracket['A'][1] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}Bye/TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}Bye/TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">A - Conf Final</h5>
                    {% for m in bracket['A'][2] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">A - Final</h5>
                    {% for m in bracket['A'][3] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="bracket-round grand-final">
                <h5 class="text-center text-warning" style="font-size:1em; font-weight:bold;">JPL FINALS</h5>
                {% for m in bracket['Final'] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins >= 3 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 3 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins >= 3 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 3 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                    {% if m.team1_wins >= 3 or m.team2_wins >= 3 %}
                    <div class="champion-area">
                        üèÜ CHAMPION üèÜ<br>
                        <span style="font-size:1.2em; color:white;">
                            {% if m.team1_wins >= 3 %}{{ m.team1_obj.name }}{% else %}{{ m.team2_obj.name }}{% endif %}
                        </span>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>

            <div class="bracket-league">
                 <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">B - Final</h5>
                    {% for m in bracket['B'][3] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">B - Conf Final</h5>
                    {% for m in bracket['B'][2] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                 <div class="bracket-round">
                    <h5 class="text-center text-white" style="font-size:0.8em;">B - Round 1</h5>
                    {% for m in bracket['B'][1] %}
                        <div class="match-card">
                            <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                            <div class="match-team {% if m.team1_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% if m.team1_wins >= 2 %} üëë{% endif %}{% else %}Bye/TBD{% endif %}</span>
                                <span class="team-score">{{ m.team1_wins }}</span>
                            </div>
                            <div class="match-team {% if m.team2_wins >= 2 %}team-winner{% endif %}">
                                <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% if m.team2_wins >= 2 %} üëë{% endif %}{% else %}Bye/TBD{% endif %}</span>
                                <span class="team-score">{{ m.team2_wins }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
  </div>
  {% endif %}

  <div class="team-section">
    <h2>ÂèÇÂä†„ÉÅ„Éº„É†</h2>
    {% if all_teams %}
      <div class="team-list">
        {% for team in all_teams %}
          <a href="{{ url_for('team_detail', team_id=team.id) }}" class="team-card">
            {% if team.logo_image %}<img src="{{ team.logo_image }}">{% endif %}<h3>{{ team.name }}</h3>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<script>
  function switchMvpTab(tabName) {
      document.querySelectorAll('.mvp-content').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.mvp-tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('mvp-' + tabName).style.display = 'block';
      event.currentTarget.classList.add('active');
  }

  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
  });
</script>
{% endblock %}