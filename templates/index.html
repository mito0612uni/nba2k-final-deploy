{% extends "layout.html" %}
{% block content %}
<style>
  /* --- „Éö„Éº„Ç∏ÂÖ®‰Ωì„ÅÆ„É©„ÉÉ„Éë„Éº --- */
  .homepage-wrapper {
    position: relative; border-radius: 8px; overflow: hidden; color: #ffffff; padding: 25px; min-height: 80vh;
  }
  .homepage-wrapper::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=1400&q=80');
    background-size: cover; background-position: center; background-attachment: fixed; z-index: -2;
  }
  .homepage-wrapper::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0, 0, 0, 0.75); z-index: -1;
  }
  .homepage-wrapper h1, .homepage-wrapper h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); }
  .homepage-wrapper h3 { color: #eee; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }

  /* Ë¶ãÂá∫„Åó„ÅÆ„Çπ„Çø„Ç§„É´ */
  .mvp-header h2, .news-section h2, .award-header h2, .team-section h2, .upcoming-section h2 {
      background-color: #002244; color: #ffd700; padding: 15px; border-radius: 8px; text-align: center; border-bottom: none; margin-bottom: 20px; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* ÊäïÁ•®„Éê„Éä„Éº */
  .vote-banner { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #333; padding: 20px; border-radius: 8px; margin-bottom: 30px; text-align: center; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4); border: 2px solid #fff; }
  .vote-banner h3 { color: #000; font-weight: 900; margin-top: 0; text-shadow: none; font-size: 1.5em; }
  .vote-btn { background-color: #333; color: #fff; padding: 12px 25px; border-radius: 30px; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 10px; transition: transform 0.2s, background-color 0.2s; border: 2px solid #333; }
  .vote-btn:hover { background-color: #fff; color: #333; transform: scale(1.05); text-decoration: none; }

  /* „Ç¢„ÉØ„Éº„ÉâÁµêÊûú„Çª„ÇØ„Ç∑„Éß„É≥ */
  .award-section { margin-bottom: 40px; }
  .award-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
  .award-card { background: rgba(255,255,255,0.95); color: #333; border-radius: 8px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
  .award-title { font-size: 1.2em; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; text-align: center; color: #004a99; text-shadow: none; }
  .award-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #ccc; align-items: center; }
  .award-pos { font-weight: bold; width: 40px; color: #555; } .award-player { flex-grow: 1; font-weight: bold; } .award-score { font-size: 0.9em; color: #666; }

  /* MVP„Çª„ÇØ„Ç∑„Éß„É≥ */
  .mvp-section { margin-bottom: 30px; }
  .mvp-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
  .mvp-column h3 { text-align: center; background-color: rgba(0,0,0,0.5); color: #fff; padding: 5px; border-radius: 6px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.2); font-size: 1em; }
  .mvp-card { background-color: rgba(255,255,255,0.95); color: #333; border-radius: 6px; padding: 8px 12px; margin-bottom: 8px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); height: auto; }
  .mvp-img { width: 40px; height: 40px; object-fit: contain; margin-right: 10px; border-radius: 50%; background: #fff; border: 1px solid #ddd; }
  .mvp-info { flex-grow: 1; } .mvp-name { font-weight: bold; font-size: 0.95em; display: block; color: #004a99; text-decoration: none; }
  .mvp-stats { font-size: 0.7em; color: #666; margin-top: 2px; line-height: 1.4; } .mvp-stats strong { color: #333; font-size: 1.1em; margin-right: 1px; }

  /* „Çø„Éñ„Å®„ÉÜ„Éº„Éñ„É´ */
  .tab-content { display: none; background: rgba(255,255,255,0.9); border: 1px solid #fff; padding: 20px; border-radius: 0 6px 6px 6px; color: #333; } .tab-content.active { display: block; }
  .stats-table { width: 100%; border-collapse: separate; border-spacing: 0; background: #ffffff; border-radius: 8px; overflow: hidden; border: 1px solid #ccc; color: #333; }
  .stats-table th { background: #343a40; color: #fff; padding: 12px; text-align: left; border-bottom: 2px solid #ddd; white-space: nowrap; }
  .stats-table td { padding: 12px; border-bottom: 1px solid #eee; color: #000; font-weight: 500; }
  .stats-table tr:last-child td { border-bottom: none; } .stats-table tr:hover { background-color: #f1f3f5; }
  .stats-table td:first-child { font-weight: bold; color: #004a99; text-align: center; }

  /* „Çπ„Çø„ÉÉ„ÉÑ„É™„Éº„ÉÄ„Éº */
  .leader-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
  .leader-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: #333; }
  .leader-card h4 { margin-top: 0; border-bottom: 2px solid #004a99; padding-bottom: 5px; color: #004a99; font-size: 1.1em; text-align: center; text-shadow: none; }
  .leader-list { padding-left: 20px; margin: 0; }
  .leader-list li { margin-bottom: 5px; display: flex; justify-content: space-between; font-size: 0.9em; border-bottom: 1px dashed #eee; padding-bottom: 3px; }
  .leader-list li:last-child { border-bottom: none; } .player-name { font-weight: bold; color: #333; } .player-stat { color: #d63384; font-weight: bold; }
  
  /* „Åù„ÅÆ‰ªñ„ÅÆ„Çπ„Çø„Ç§„É´ */
  .tab-navigation { display: flex; gap: 5px; margin-bottom: -1px; }
  .tab-btn { padding: 12px 22px; background: rgba(0,0,0,0.6); color: #ccc; border: 1px solid #555; border-bottom: none; border-radius: 6px 6px 0 0; cursor: pointer; font-weight: bold; }
  .tab-btn.active { background: rgba(255,255,255,0.9); color: #333; border-color: #fff; }
  
  .team-cell { display: flex; align-items: center; gap: 10px; } .team-cell img { height: 25px; }
  .league-tag { font-size: 12px; padding: 3px 8px; border-radius: 10px; font-weight: bold; }
  .league-tag-a { background: #ffebee; color: #c62828; } .league-tag-b { background: #e3f2fd; color: #1565c0; }
  .upcoming-game-item { background: rgba(255,255,255,0.9); border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; color: #333; }
  .game-teams { font-weight: bold; font-size: 1.1em; } .game-teams img { height: 20px; margin: 0 5px; vertical-align: middle; }
  .game-link a { background: #007bff; color: #fff; padding: 8px 12px; border-radius: 4px; text-decoration: none; }
  .team-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
  .team-card { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; text-align: center; color: #333; text-decoration: none; }
  .team-card:hover { transform: translateY(-5px); } .team-card img { width: 80px; margin-bottom: 10px; }
  .news-section { background-color: rgba(0, 0, 0, 0.6); border: 1px solid #555; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
  .news-item { border-bottom: 1px solid #777; padding: 15px 0; } .news-item:last-child { border-bottom: none; }
  .news-item h4 { margin: 0 0 5px; color: #4dabf7; font-size: 1.3em; } .news-date { color: #ccc; font-size: 0.9em; } .news-content { margin: 0; line-height: 1.6; }

/* --- „Éñ„É©„Ç±„ÉÉ„Éà(„Éà„Éº„Éä„É°„É≥„ÉàË°®)Áî®„Çπ„Çø„Ç§„É´ --- */
.bracket-container {
    display: flex;
    justify-content: center;
    overflow-x: auto;
    padding: 20px 0;
    background: rgba(0,0,0,0.3); /* ËÉåÊôØ„ÇíÂ∞ë„ÅóÊöó„Åè */
    border-radius: 8px;
    margin-bottom: 40px;
}
.bracket-league {
    display: flex;
}
.bracket-round {
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    width: 160px; /* „Ç´„Éº„Éâ„ÅÆÂπÖ */
    margin: 0 10px;
}
.match-card {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px;
    margin: 10px 0;
    position: relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    font-size: 0.85em;
    color: #333;
}
.match-date {
    font-size: 0.75em;
    color: #666;
    text-align: center;
    border-bottom: 1px solid #eee;
    margin-bottom: 4px;
}
.match-team {
    display: flex;
    justify-content: space-between;
    padding: 2px 5px;
}
/* ÂãùÂà©„ÉÅ„Éº„É†„ÅÆÂº∑Ë™ø */
.team-winner {
    font-weight: bold;
    background-color: #fff3cd; /* ËñÑ„ÅÑÈªÑËâ≤ */
    color: #000;
}
.team-score {
    font-weight: bold;
    margin-left: 5px;
}
/* „Ç∞„É©„É≥„Éâ„Éï„Ç°„Ç§„Éä„É´ÁâπÂà•‰ªïÊßò */
.grand-final {
    width: 200px;
}
.grand-final .match-card {
    border: 2px solid #ffd700;
    transform: scale(1.1);
}
/* „ÉÅ„É£„É≥„Éî„Ç™„É≥Áî®„Éà„É≠„Éï„Ç£„Éº„Ç¢„Ç§„Ç≥„É≥„Ç®„É™„Ç¢ */
.champion-area {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
    color: #ffd700;
}

/* „Éã„É•„Éº„ÇπÁîªÂÉè„ÅÆ„Çπ„Çø„Ç§„É´ */
.news-image {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    border-radius: 5px;
    margin-top: 10px;
    border: 1px solid #555;
}
</style>

<div class="homepage-wrapper">
  <h1>NBA2K JPL</h1>

  {% if active_votes %}
  <div class="vote-banner">
      <h3>üì¢ ÁèæÂú®„ÄÅÊäïÁ•®„ÇíÂèó„Åë‰ªò„Åë„Å¶„ÅÑ„Åæ„ÅôÔºÅ</h3>
      <p style="margin: 10px 0;">„ÅÇ„Å™„Åü„ÅÆ1Á•®„Åå„É™„Éº„Ç∞„ÇíÁõõ„Çä‰∏ä„Åí„Åæ„Åô„ÄÇ„Åú„Å≤„ÅîÂèÇÂä†„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
      <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap;">
          {% for vote in active_votes %}
              <a href="{{ url_for('vote_page', config_id=vote.id) }}" class="vote-btn">
                  {{ vote.title }} „Å´ÊäïÁ•®„Åô„Çã üó≥Ô∏è
              </a>
          {% endfor %}
      </div>
  </div>
  {% endif %}

  {% if latest_result %}
  <div class="latest-result-banner">
      <p style="margin: 0;">
          ÁµêÊûúÂÖ•Âäõ: 
          {{ latest_result.home_team.name }}
          <a href="{{ url_for('game_result', game_id=latest_result.id) }}">
              {{ latest_result.home_score }} - {{ latest_result.away_score }}
          </a>
          {{ latest_result.away_team.name }}
      </p>
  </div>
  {% endif %}

  {% for p_vote in published_votes %}
  <div class="award-section">
      <div class="award-header">
          <h2>üèÜ {{ p_vote.title }} ÁµêÊûúÁô∫Ë°®</h2>
      </div>
      
      {% if p_vote.vote_type == 'weekly' %}
         <div class="award-card" style="text-align: center;">
             <div style="display:flex; justify-content:space-around; gap:20px;">
                {% for res in p_vote.results if res.rank == 1 %}
                    <div style="flex:1;">
                        <h3 style="color:#004a99; margin-top:0;">
                            {{ res.category.split(' ')[-2] }}„É™„Éº„Ç∞ MVP
                        </h3>
                        <p style="font-size:1.5em; font-weight:bold;">
                            üéâ {{ res.player.name }} <small>({{ res.player.team.name }})</small>
                        </p>
                        <p style="font-size:1.0em; font-weight:bold;">{{ res.score }}Á•®</p>
                    </div>
                {% endfor %}
            </div>
         </div>
      
      {% elif p_vote.vote_type == 'all_star' %}
         <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
             <div class="award-card" style="border-top: 5px solid #c62828;">
                 <h3 style="text-align:center; color:#c62828; margin-top:0;">A„É™„Éº„Ç∞</h3>
                 {% for res in p_vote.results if 'A„É™„Éº„Ç∞' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('A„É™„Éº„Ç∞ ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}Á•®</span>
                     </div>
                 {% endfor %}
             </div>
             <div class="award-card" style="border-top: 5px solid #1565c0;">
                 <h3 style="text-align:center; color:#1565c0; margin-top:0;">B„É™„Éº„Ç∞</h3>
                 {% for res in p_vote.results if 'B„É™„Éº„Ç∞' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.replace('B„É™„Éº„Ç∞ ', '') }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}Á•®</span>
                     </div>
                 {% endfor %}
             </div>
         </div>

      {% elif p_vote.vote_type == 'awards' %}
         <div class="award-grid">
             <div class="award-card">
                 <div class="award-title">ÂÄã‰∫∫Ë≥û</div>
                 {% for res in p_vote.results if res.category in ['MVP', 'DPOY'] and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos" style="width:60px;">{{ res.category }}</span>
                         <span class="award-player" style="font-size:1.1em;">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>

             <div class="award-card">
                 <div class="award-title">All JPL 1st Team</div>
                 {% for res in p_vote.results if '1st Team' in res.category and res.rank == 1 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>

             <div class="award-card">
                 <div class="award-title">All JPL 2nd Team</div>
                 {% for res in p_vote.results if '2nd Team' in res.category and res.rank == 2 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>
             
             <div class="award-card">
                 <div class="award-title">All JPL 3rd Team</div>
                 {% for res in p_vote.results if '3rd Team' in res.category and res.rank == 3 %}
                     <div class="award-row">
                         <span class="award-pos">{{ res.category.split(' ')[2] if res.category.split(' ')|length > 2 else '?' }}</span>
                         <span class="award-player">{{ res.player.name }}</span>
                         <span class="award-score">{{ res.score }}pt</span>
                     </div>
                 {% endfor %}
             </div>
         </div>
      {% endif %}
  </div>
  {% endfor %}

  {% if show_mvp and (top_players_a or top_players_b) %}
  <div class="mvp-section">
      <div class="mvp-header">
          <h2>WEEKLY MVP CANDIDATES</h2>
      </div>
      <div class="mvp-grid">
          {% for league_name, players in [('A„É™„Éº„Ç∞', top_players_a), ('B„É™„Éº„Ç∞', top_players_b)] %}
          <div class="mvp-column">
              <h3>{{ league_name }}</h3>
              {% for p in players %}
              <div class="mvp-card">
                  {% if p.player.team.logo_image %}
                    <img src="{{ p.player.team.logo_image }}" class="mvp-img">
                  {% endif %}
                  <div class="mvp-info">
                      <a href="{{ url_for('player_detail', player_id=p.player_id) }}" class="mvp-name">{{ p.player.name }} ({{ p.player.team.name }})</a>
                      <div class="mvp-stats">
                          <strong>{{ "%.1f"|format(p.avg_pts) }}</strong> PTS / 
                          <strong>{{ "%.1f"|format(p.avg_reb) }}</strong> REB / 
                          <strong>{{ "%.1f"|format(p.avg_ast) }}</strong> AST <br>
                          <strong>{{ "%.1f"|format(p.avg_stl) }}</strong> STL / 
                          <strong>{{ "%.1f"|format(p.avg_blk) }}</strong> BLK / 
                          <strong>{{ "%.1f"|format(p.fg_pct) }}</strong> FG% / 
                          <strong>{{ "%.1f"|format(p.three_pt_pct) }}</strong> 3P%
                      </div>
                  </div>
              </div>
              {% endfor %}
          </div>
          {% endfor %}
      </div>
  </div>
  {% endif %}

  {% if news_items %}
  <section class="news-section">
      <h2>„É™„Éº„Ç∞„Åã„Çâ„ÅÆ„ÅäÁü•„Çâ„Åõ</h2>
      <div class="news-list">
          {% for item in news_items %}
          <div class="news-item">
              <h4>{{ item.title }}</h4>
              <small class="news-date">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }} (UTC)</small>
              <p class="news-content">{{ item.content | replace('\n', '<br>') | safe }}</p>
              {% if item.image_url %}
              <img src="{{ item.image_url }}" alt="news image" class="news-image">
              {% endif %}
          </div>
          {% endfor %}
      </div>
  </section>
  {% endif %}
  
  <section class="tab-section">
    <div class="tab-navigation">
      <button class="tab-btn active" data-tab="overall">Á∑èÂêàÈ†Ü‰Ωç</button>
      <button class="tab-btn" data-tab="a-league">A„É™„Éº„Ç∞</button>
      <button class="tab-btn" data-tab="b-league">B„É™„Éº„Ç∞</button>
      <button class="tab-btn" data-tab="leaders">„Çπ„Çø„ÉÉ„ÉÑ</button>
    </div>

    <div id="overall" class="tab-content active">
      <h3>Á∑èÂêàÈ†Ü‰Ωç</h3>
      {% if overall_standings %}
      <div style="overflow-x: auto;"> <table class="stats-table">
          <thead><tr><th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>„É™„Éº„Ç∞</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th><th>Âπ≥ÂùáÂæóÁÇπ</th><th>Âπ≥ÂùáÂ§±ÁÇπ</th><th>ÂæóÂ§±ÁÇπÂ∑Æ</th></tr></thead>
          <tbody>
            {% for row in overall_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td>
              <td>{% if row.league == 'A„É™„Éº„Ç∞' %}<span class="league-tag league-tag-a">A„É™„Éº„Ç∞</span>{% elif row.league == 'B„É™„Éº„Ç∞' %}<span class="league-tag league-tag-b">B„É™„Éº„Ç∞</span>{% endif %}</td>
              <td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p>„Éá„Éº„Çø„Å™„Åó</p>{% endif %}
    </div>
    <div id="a-league" class="tab-content">
       <h3>A„É™„Éº„Ç∞ È†Ü‰ΩçË°®</h3>
       {% if league_a_standings %}
       <div style="overflow-x: auto;">
         <table class="stats-table"><thead><tr><th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th><th>Âπ≥ÂùáÂæóÁÇπ</th><th>Âπ≥ÂùáÂ§±ÁÇπ</th><th>ÂæóÂ§±ÁÇπÂ∑Æ</th></tr></thead><tbody>
             {% for row in league_a_standings %}<tr><td>{{ loop.index }}</td><td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td><td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td></tr>{% endfor %}
         </tbody></table></div>{% endif %}
    </div>
    <div id="b-league" class="tab-content">
        <h3>B„É™„Éº„Ç∞ È†Ü‰ΩçË°®</h3>
        {% if league_b_standings %}
        <div style="overflow-x: auto;">
          <table class="stats-table"><thead><tr><th>È†Ü‰Ωç</th><th>„ÉÅ„Éº„É†Âêç</th><th>Âãù</th><th>Êïó</th><th>ÂãùÁÇπ</th><th>Âπ≥ÂùáÂæóÁÇπ</th><th>Âπ≥ÂùáÂ§±ÁÇπ</th><th>ÂæóÂ§±ÁÇπÂ∑Æ</th></tr></thead><tbody>
              {% for row in league_b_standings %}<tr><td>{{ loop.index }}</td><td class="team-cell">{% if row.team.logo_image %}<img src="{{ row.team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a></td><td>{{ row.wins }}</td><td>{{ row.losses }}</td><td><strong>{{ row.points }}</strong></td><td>{{ "%.1f"|format(row.avg_pf) }}</td><td>{{ "%.1f"|format(row.avg_pa) }}</td><td>{{ row.diff }}</td></tr>{% endfor %}
          </tbody></table></div>{% endif %}
    </div>
    <div id="leaders" class="tab-content">
      <div class="leader-header"><h3>„Çπ„Çø„ÉÉ„ÉÑ„É™„Éº„ÉÄ„Éº (Top 5)</h3><a href="{{ url_for('stats_page') }}" class="button green">Ë©≥Á¥∞</a></div><br>
      <div class="leader-grid">
        {% for category_name, players in leaders.items() %}
          <div class="leader-card"><h4>{{ category_name }}</h4><ol class="leader-list">{% for player in players %}{% if player[1] is not none and player[1] > 0 %}<li><span class="player-name"><a href="{{ url_for('player_detail', player_id=player[2]) }}">{{ player[0] }}</a></span><span class="player-stat">{{ "%.1f"|format(player[1]) }}</span></li>{% endif %}{% else %}<li>„Éá„Éº„Çø„Å™„Åó</li>{% endfor %}</ol></div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="upcoming-section">
    <h2>‰ªäÂæå„ÅÆË©¶Âêà</h2>
    <div class="upcoming-game-list">
      {% for game in upcoming_games %}
        <div class="upcoming-game-item">
          <div>
            <div class="game-date">{{ game.game_date }} {{ game.start_time }}</div>
            <div class="game-teams">
              {% if game.home_team.logo_image %}<img src="{{ game.home_team.logo_image }}">{% endif %}<a href="{{ url_for('team_detail', team_id=game.home_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.home_team.name }}</a> <span style="margin:0 10px;">vs</span> <a href="{{ url_for('team_detail', team_id=game.away_team.id) }}" style="color:inherit; text-decoration:none;">{{ game.away_team.name }}</a>{% if game.away_team.logo_image %}<img src="{{ game.away_team.logo_image }}">{% endif %}
            </div>
          </div>
          <div class="game-link">{% if current_user.is_authenticated %}<a href="{{ url_for('edit_game', game_id=game.id) }}">ÁµêÊûúÂÖ•Âäõ</a>{% else %}<span style="color:#666; font-size:0.8em;">Ë©¶ÂêàÂâç</span>{% endif %}</div>
        </div>
      {% else %}<p>‰∫àÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãË©¶Âêà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>{% endfor %}
    </div>
  </section>

  {% if show_playoff %}
  <div class="upcoming-section">
    <h2>PLAYOFF BRACKET</h2>
    
    {% if current_user.is_admin %}
    <div style="text-align:center; margin-bottom:10px;">
        <a href="{{ url_for('admin_playoff') }}" class="button primary small">„Éà„Éº„Éä„É°„É≥„ÉàË°®„ÇíÁ∑®ÈõÜ</a>
    </div>
    {% endif %}

    <div class="bracket-container">
        <div class="bracket-league">
            <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">A - Round 1</h5>
                {% for m in bracket['A'][1] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">A - Conf Final</h5>
                {% for m in bracket['A'][2] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">A - Final</h5>
                {% for m in bracket['A'][3] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="bracket-round grand-final">
            <h5 class="text-center text-warning" style="font-size:1em; font-weight:bold;">NBA2K JPL FINALS</h5>
            {% for m in bracket['Final'] %}
                <div class="match-card">
                    <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                    <div class="match-team {% if m.team1_wins > m.team2_wins %}team-winner{% endif %}">
                        <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}TBD{% endif %}</span>
                        <span class="team-score">{{ m.team1_wins }}</span>
                    </div>
                    <div class="match-team {% if m.team2_wins > m.team1_wins %}team-winner{% endif %}">
                        <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}TBD{% endif %}</span>
                        <span class="team-score">{{ m.team2_wins }}</span>
                    </div>
                </div>
                {% if m.team1_wins == 4 or m.team2_wins == 4 %}
                <div class="champion-area">
                    üèÜ CHAMPION üèÜ<br>
                    <span style="font-size:1.2em; color:white;">
                        {% if m.team1_wins == 4 %}{{ m.team1_obj.name }}{% else %}{{ m.team2_obj.name }}{% endif %}
                    </span>
                </div>
                {% endif %}
            {% endfor %}
        </div>

        <div class="bracket-league">
             <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">B - Final</h5>
                {% for m in bracket['B'][3] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">B - Conf Final</h5>
                {% for m in bracket['B'][2] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
             <div class="bracket-round">
                <h5 class="text-center text-white" style="font-size:0.8em;">B - Round 1</h5>
                {% for m in bracket['B'][1] %}
                    <div class="match-card">
                        <div class="match-date">{{ m.schedule_note or 'TBD' }}</div>
                        <div class="match-team {% if m.team1_wins > m.team2_wins and m.team1_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team1_obj %}<img src="{{ m.team1_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team1_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team1_wins }}</span>
                        </div>
                        <div class="match-team {% if m.team2_wins > m.team1_wins and m.team2_wins >= 4 %}team-winner{% endif %}">
                            <span>{% if m.team2_obj %}<img src="{{ m.team2_obj.logo_image }}" style="height:15px; width:15px; object-fit:contain; margin-right:3px;"> {{ m.team2_obj.name }}{% else %}Bye / TBD{% endif %}</span>
                            <span class="team-score">{{ m.team2_wins }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

  <div class="team-section">
    <h2>ÂèÇÂä†„ÉÅ„Éº„É†</h2>
    {% if all_teams %}
      <div class="team-list">
        {% for team in all_teams %}
          <a href="{{ url_for('team_detail', team_id=team.id) }}" class="team-card">
            {% if team.logo_image %}<img src="{{ team.logo_image }}">{% endif %}<h3>{{ team.name }}</h3>
          </a>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
  });
</script>
{% endblock %}