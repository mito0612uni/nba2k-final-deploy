{% extends "layout.html" %}
{% block content %}
<style>
    /* --- スタッツページ専用スタイル --- */
    .stats-container {
        max-width: 1400px; /* 横幅を広く取る */
        margin: 30px auto;
        padding: 0 20px;
    }
    
    .stats-section {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        padding: 20px;
        margin-bottom: 40px;
        border: 1px solid #eee;
    }

    h2 {
        color: #004a99;
        font-weight: 800;
        border-left: 5px solid #ffd700;
        padding-left: 15px;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }

    /* ▼▼▼ テーブルのスクロール対応 ▼▼▼ */
    .table-responsive {
        overflow-x: auto; /* 横スクロールを有効化 */
        -webkit-overflow-scrolling: touch; /* スマホでの慣性スクロール */
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 800px; /* 縦にも長い場合はスクロール */
        overflow-y: auto;
    }

    .stats-table {
        width: 100%;
        border-collapse: separate; /* 固定カラムのためにseparateが必要 */
        border-spacing: 0;
        font-size: 0.9rem;
        white-space: nowrap; /* テキストの折り返しを禁止 */
    }

    .stats-table th, .stats-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
        border-right: 1px solid #f0f0f0;
        text-align: center;
    }

    /* ヘッダー固定 */
    .stats-table th {
        background: #343a40;
        color: #fff;
        font-weight: bold;
        position: sticky;
        top: 0;
        z-index: 10;
        border-right-color: #555;
    }

    /* ▼▼▼ 左端カラム（名前）の固定設定 ▼▼▼ */
    .stats-table th:first-child,
    .stats-table td:first-child {
        position: sticky;
        left: 0;
        z-index: 11; /* 他のセルより前面に */
        border-right: 2px solid #ddd; /* 固定境界線 */
        text-align: left;
        min-width: 160px; /* 名前が見える最低幅を確保 */
    }
    
    .stats-table th:first-child {
        background: #343a40; /* ヘッダー背景 */
        z-index: 20; /* 最前面 */
    }
    
    .stats-table td:first-child {
        background: #fff; /* スクロール時に透けないように背景色を指定 */
        font-weight: bold;
        color: #004a99;
    }

    /* 縞模様（固定カラムの背景色も合わせる） */
    .stats-table tbody tr:nth-child(even) td {
        background-color: #f8f9fa;
    }
    .stats-table tbody tr:nth-child(even) td:first-child {
        background-color: #f8f9fa;
    }
    
    /* ホバー効果 */
    .stats-table tbody tr:hover td {
        background-color: #e9ecef;
    }
    .stats-table tbody tr:hover td:first-child {
        background-color: #e9ecef;
    }

    /* リンクスタイル */
    .stats-table a {
        text-decoration: none;
        color: inherit;
    }
    .stats-table a:hover {
        text-decoration: underline;
        color: #0056b3;
    }

    /* 数値の強調 */
    .val-main { font-weight: bold; color: #222; font-size: 1rem; }
    .val-sub { color: #666; font-size: 0.85rem; }
    .val-pct { color: #007bff; font-weight: bold; }
    
    /* チームロゴ */
    .mini-logo {
        height: 24px; width: 24px; object-fit: contain;
        vertical-align: middle; margin-right: 5px;
        background: #fff; border-radius: 50%; border: 1px solid #eee;
    }
</style>

<div class="stats-container">
    
    <div class="stats-section">
        <h2>チーム成績 (平均)</h2>
        <div class="table-responsive">
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>チーム名</th>
                        <th>リーグ</th>
                        <th>勝</th><th>敗</th><th>勝点</th>
                        <th>平均得点</th><th>平均失点</th><th>得失差</th>
                        <th>AST</th><th>REB</th><th>STL</th><th>BLK</th>
                        <th>TO</th><th>FOUL</th>
                        <th>FG%</th><th>3P%</th><th>FT%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in team_stats %}
                    <tr>
                        <td>
                            {% if row.team.logo_image %}
                            <img src="{{ row.team.logo_image }}" class="mini-logo">
                            {% endif %}
                            <a href="{{ url_for('team_detail', team_id=row.team.id) }}">{{ row.team_name }}</a>
                        </td>
                        <td>
                            <span style="font-size:0.8em; padding:2px 6px; border-radius:4px; 
                                background:{% if row.league=='Aリーグ' %}#ffebee;color:#c62828{% else %}#e3f2fd;color:#1565c0{% endif %}">
                                {{ row.league }}
                            </span>
                        </td>
                        <td>{{ row.wins }}</td>
                        <td>{{ row.losses }}</td>
                        <td style="font-weight:bold;">{{ row.points }}</td>
                        
                        <td class="val-main">{{ "%.1f"|format(row.avg_pf) }}</td>
                        <td>{{ "%.1f"|format(row.avg_pa) }}</td>
                        <td style="color:{% if row.diff > 0 %}green{% elif row.diff < 0 %}red{% endif %};">{{ row.diff }}</td>
                        
                        <td>{{ "%.1f"|format(row.avg_ast) }}</td>
                        <td>{{ "%.1f"|format(row.avg_reb) }}</td>
                        <td>{{ "%.1f"|format(row.avg_stl) }}</td>
                        <td>{{ "%.1f"|format(row.avg_blk) }}</td>
                        <td>{{ "%.1f"|format(row.avg_turnover) }}</td>
                        <td>{{ "%.1f"|format(row.avg_foul) }}</td>
                        
                        <td class="val-pct">{{ "%.1f"|format(row.fg_pct) }}%</td>
                        <td class="val-pct">{{ "%.1f"|format(row.three_p_pct) }}%</td>
                        <td class="val-pct">{{ "%.1f"|format(row.ft_pct) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="stats-section">
        <h2>個人成績 (平均)</h2>
        <p style="font-size:0.9em; color:#666; margin-bottom:10px;">※項目名クリックでソート機能は現在準備中です。</p>
        <div class="table-responsive">
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>選手名</th>
                        <th>チーム</th>
                        <th>試合</th>
                        <th>PTS</th><th>REB</th><th>AST</th><th>STL</th><th>BLK</th>
                        <th>TO</th><th>FOUL</th>
                        <th>FGM</th><th>FGA</th><th>FG%</th>
                        <th>3PM</th><th>3PA</th><th>3P%</th>
                        <th>FTM</th><th>FTA</th><th>FT%</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in individual_stats %}
                    <tr>
                        <td><a href="{{ url_for('player_detail', player_id=row.player_id) }}">{{ row.player_name }}</a></td>
                        <td style="text-align:left; font-size:0.9em;">{{ row.team_name }}</td>
                        <td>{{ row.games_played }}</td>
                        
                        <td class="val-main">{{ "%.1f"|format(row.avg_pts) }}</td>
                        <td>{{ "%.1f"|format(row.avg_reb) }}</td>
                        <td>{{ "%.1f"|format(row.avg_ast) }}</td>
                        <td>{{ "%.1f"|format(row.avg_stl) }}</td>
                        <td>{{ "%.1f"|format(row.avg_blk) }}</td>
                        
                        <td>{{ "%.1f"|format(row.avg_turnover) }}</td>
                        <td>{{ "%.1f"|format(row.avg_foul) }}</td>
                        
                        <td class="val-sub">{{ "%.1f"|format(row.avg_fgm) }}</td>
                        <td class="val-sub">{{ "%.1f"|format(row.avg_fga) }}</td>
                        <td class="val-pct">{{ "%.1f"|format(row.fg_pct) }}%</td>
                        
                        <td class="val-sub">{{ "%.1f"|format(row.avg_three_pm) }}</td>
                        <td class="val-sub">{{ "%.1f"|format(row.avg_three_pa) }}</td>
                        <td class="val-pct">{{ "%.1f"|format(row.three_p_pct) }}%</td>
                        
                        <td class="val-sub">{{ "%.1f"|format(row.avg_ftm) }}</td>
                        <td class="val-sub">{{ "%.1f"|format(row.avg_fta) }}</td>
                        <td class="val-pct">{{ "%.1f"|format(row.ft_pct) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}