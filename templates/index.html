{% extends "layout.html" %}
{% block content %}
<style>
  /* --- ページ全体のラッパー --- */
  .homepage-wrapper {
    position: relative; /* オーバーレイの基準点 */
    border-radius: 8px;
    overflow: hidden; /* 角丸を適用 */
    color: #ffffff; /* メインの文字色を白に */
    padding: 25px;
  }

  /* --- 背景画像 --- */
  .homepage-wrapper::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    /* ★お好みのバスケの背景画像を指定してください★ */
    background-image: url('https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=1400&q=80');
    background-size: cover;
    background-position: center;
    background-attachment: fixed; /* スクロールしても背景を固定 */
    z-index: -2;
  }

  /* --- 背景画像のオーバーレイ (文字を読みやすくするため) --- */
  .homepage-wrapper::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0, 0, 0, 0.75); /* 暗めのオーバーレイ */
    z-index: -1;
  }
  
  .homepage-wrapper h1,
  .homepage-wrapper h2 {
    border-bottom: 2px solid #004a99; /* ネイビーに統一 */
    padding-bottom: 10px;
  }
  .homepage-wrapper h3 {
    color: #eee;
  }

  /* ★★★ スタイル新規追加：速報バナーのデザイン ★★★ */
  .latest-result-banner {
      background-color: #ffe6e6; /* 薄い赤の背景 */
      color: #dc3545; /* 強調用の赤 */
      padding: 10px 15px;
      margin-bottom: 25px;
      border: 1px solid #dc3545;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  .latest-result-banner a {
      color: #004a99; /* ネイビー */
      text-decoration: none;
      font-weight: 900;
  }
  .latest-result-banner a:hover {
      text-decoration: underline;
  }
  
  /* ★★★ ニュースセクション用のスタイル (以前の修正を再適用) ★★★ */
  .news-section {
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid #555;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
  }
  .news-item {
      border-bottom: 1px solid #555;
      padding: 15px 0;
  }
  .news-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
  }
  .news-item:first-child {
      padding-top: 0;
  }
  .news-item h4 {
      margin-top: 0;
      margin-bottom: 5px;
      color: #007bff;
      font-size: 1.3em;
  }
  .news-item .news-date {
      color: #ccc;
      display: block;
      margin-bottom: 10px;
      font-size: 0.9em;
  }
  .news-item .news-content {
      margin-bottom: 0;
      line-height: 1.6;
      white-space: pre-wrap; /* 改行を反映させる */
  }

  /* --- タブ切り替え --- */
  .tab-navigation {
    display: flex;
    gap: 5px;
    margin-bottom: -1px; /*下のボーダーと一体化*/
  }
  .tab-btn {
    padding: 12px 22px;
    background-color: rgba(0, 0, 0, 0.4);
    color: #ccc;
    border: 1px solid #555;
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
  }
  .tab-btn.active {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    border-color: #777;
  }
  .tab-content {
    display: none; /* JSで active をつけて表示 */
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid #777;
    padding: 20px;
    border-radius: 0 6px 6px 6px;
  }
  .tab-content.active {
    display: block;
  }

  /* --- 順位表テーブル --- */
  .stats-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    overflow-x: auto; /* スマホ表示で横スクロール */
    display: block;
  }
  .stats-table th, .stats-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    white-space: nowrap; /* 折り返さない */
  }
  .stats-table th {
    background-color: rgba(0, 0, 0, 0.2);
    font-size: 14px;
  }
  .stats-table td { font-size: 15px; }
  .stats-table tr:hover {
    background-color: rgba(255, 255, 255, 0.15);
  }
  
  /* 順位表のチーム名リンク用CSS */
  .stats-table td a {
    color: inherit; /* 親の文字色 (白) を継承 */
    text-decoration: none;
    font-weight: bold;
  }
  .stats-table td a:hover {
    color: #007bff;
    text-decoration: underline;
  }
  
  /* チーム名 (ロゴ + 名前) */
  .team-cell { display: flex; align-items: center; gap: 10px; }
  .team-cell img {
    height: 25px;
    width: 25px;
    object-fit: contain;
  }
  /* リーグのタグ (以前の背景色の代わり) */
  .league-tag {
    font-size: 12px;
    font-weight: bold;
    padding: 3px 8px;
    border-radius: 10px;
    margin-left: 5px;
  }
  .league-tag-a { background-color: #ffebee; color: #c62828; }
  .league-tag-b { background-color: #e3f2fd; color: #1565c0; }


  /* --- スタッツリーダー --- */
  .leader-header {
    display: flex; justify-content: space-between; align-items: center;
  }
  .leader-grid {
    display: grid;
    /* 画面幅に合わせて列数を自動調整 */
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
  }
  .leader-card {
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 8px;
    padding: 15px;
  }
  .leader-card h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #007bff;
    font-size: 1.2em;
  }
  .leader-list { padding-left: 20px; margin: 0; }
  .leader-list li {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    font-size: 15px;
  }
  .leader-list .player-name { font-weight: 500; }
  .leader-list .player-stat { font-weight: bold; }
  /* スタッツリーダーの選手名リンク用CSS */
  .leader-list .player-name a {
    color: inherit;
    text-decoration: none;
  }
  .leader-list .player-name a:hover {
    color: #007bff;
    text-decoration: underline;
  }


  /* --- 試合日程セクション --- */
  .upcoming-section { margin-top: 30px; }
  .upcoming-game-item {
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid #555;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; /* スマホ対応 */
    gap: 15px;
  }
  .game-teams { font-weight: bold; font-size: 1.1em; }
  .game-teams img { height: 20px; vertical-align: middle; margin: 0 5px; }
  .game-date { font-size: 0.9em; color: #ccc; }
  .game-link a {
    color: #fff;
    background-color: #007bff;
    padding: 8px 12px;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    white-space: nowrap;
  }
  .game-link a:hover { background-color: #0056b3; }
  
  /* 汎用ボタン */
  .button.green {
    text-decoration: none; background-color: #28a745; color: white; padding: 8px 15px; border-radius: 5px;
  }

</style>

<div class="homepage-wrapper">
  <h1>NBA2K JPL</h1>

  {% if latest_result %}
  <div class="latest-result-banner">
      <p style="margin: 0;">
          結果が入力されました: 
          {{ latest_result.home_team.name }}
          <a href="{{ url_for('game_result', game_id=latest_result.id) }}">
              {{ latest_result.home_score }} - {{ latest_result.away_score }}
          </a>
          {{ latest_result.away_team.name }}
      </p>
  </div>
  {% endif %}
  {% if news_items %}
  <section class="news-section">
      <h2>リーグからのお知らせ</h2>
      <div class="news-list">
          {% for item in news_items %}
          <div class="news-item">
              <h4>{{ item.title }}</h4>
              <small class="news-date">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }} (UTC)</small>
              <p class="news-content">{{ item.content | replace('\n', '<br>') | safe }}</p>
          </div>
          {% endfor %}
      </div>
  </section>
  {% endif %}
  
  <section class="tab-section">
    <div class="tab-navigation">
      <button class="tab-btn active" data-tab="overall">総合順位</button>
      <button class="tab-btn" data-tab="a-league">Aリーグ</button>
      <button class="tab-btn" data-tab="b-league">Bリーグ</button>
      <button class="tab-btn" data-tab="leaders">スタッツ</button>
    </div>

    <div id="overall" class="tab-content active">
      <h3>総合順位</h3>
      {% if overall_standings %}
      <div style="overflow-x: auto;"> <table class="stats-table">
          <thead>
            <tr>
              <th>順位</th>
              <th>チーム名</th>
              <th>リーグ</th>
              <th>勝</th>
              <th>敗</th>
              <th>勝点</th>
              <th>平均得点</th>
              <th>平均失点</th>
              <th>得失点差</th>
            </tr>
          </thead>
          <tbody>
            {% for row in overall_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">
                {% if row.team and row.team.logo_image %}
                  <img src="{{ row.team.logo_image }}" alt="">
                {% endif %}
                <a href="{{ url_for('team_detail', team_id=row.team.id) }}">
                  <span>{{ row.team_name }}</span>
                </a>
              </td>
              <td>
                {% if row.league == 'Aリーグ' %}
                  <span class="league-tag league-tag-a">Aリーグ</span>
                {% elif row.league == 'Bリーグ' %}
                  <span class="league-tag league-tag-b">Bリーグ</span>
                {% endif %}
              </td>
              <td>{{ row.wins }}</td>
              <td>{{ row.losses }}</td>
              <td><strong>{{ row.points }}</strong></td>
              <td>{{ "%.1f"|format(row.avg_pf) }}</td>
              <td>{{ "%.1f"|format(row.avg_pa) }}</td>
              <td>{{ row.diff }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p>まだ試合結果がありません。</p>{% endif %}
    </div>

    <div id="a-league" class="tab-content">
      <h3>Aリーグ 順位表</h3>
      {% if league_a_standings %}
      <div style="overflow-x: auto;">
        <table class="stats-table">
          <thead>
            <tr>
              <th>順位</th>
              <th>チーム名</th>
              <th>勝</th>
              <th>敗</th>
              <th>勝点</th>
              <th>平均得点</th>
              <th>平均失点</th>
              <th>得失点差</th>
            </tr>
          </thead>
          <tbody>
            {% for row in league_a_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">
                {% if row.team and row.team.logo_image %}
                  <img src="{{ row.team.logo_image }}" alt="">
                {% endif %}
                <a href="{{ url_for('team_detail', team_id=row.team.id) }}">
                  <span>{{ row.team_name }}</span>
                </a>
              </td>
              <td>{{ row.wins }}</td>
              <td>{{ row.losses }}</td>
              <td><strong>{{ row.points }}</strong></td>
              <td>{{ "%.1f"|format(row.avg_pf) }}</td>
              <td>{{ "%.1f"|format(row.avg_pa) }}</td>
              <td>{{ row.diff }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p>試合結果がありません。</p>{% endif %}
    </div>
    
    <div id="b-league" class="tab-content">
      <h3>Bリーグ 順位表</h3>
      {% if league_b_standings %}
      <div style="overflow-x: auto;">
        <table class="stats-table">
          <thead>
            <tr>
              <th>順位</th>
              <th>チーム名</th>
              <th>勝</th>
              <th>敗</th>
              <th>勝点</th>
              <th>平均得点</th>
              <th>平均失点</th>
              <th>得失点差</th>
            </tr>
          </thead>
          <tbody>
            {% for row in league_b_standings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td class="team-cell">
                {% if row.team and row.team.logo_image %}
                  <img src="{{ row.team.logo_image }}" alt="">
                {% endif %}
                <a href="{{ url_for('team_detail', team_id=row.team.id) }}">
                  <span>{{ row.team_name }}</span>
                </a>
              </td>
              <td>{{ row.wins }}</td>
              <td>{{ row.losses }}</td>
              <td><strong>{{ row.points }}</strong></td>
              <td>{{ "%.1f"|format(row.avg_pf) }}</td>
              <td>{{ "%.1f"|format(row.avg_pa) }}</td>
              <td>{{ row.diff }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}<p>試合結果がありません。</p>{% endif %}
    </div>

    <div id="leaders" class="tab-content">
      <div class="leader-header">
        <h3>スタッツリーダー (Top 5)</h3>
        <a href="{{ url_for('stats_page') }}" class="button green">詳細スタッツを見る</a>
      </div>
      <br>
      <div class="leader-grid">
        {% for category_name, players in leaders.items() %}
          <div class="leader-card">
            <h4>{{ category_name }}</h4>
            <ol class="leader-list">
              {% for player in players %}
                {% if player[1] is not none and player[1] > 0 %}
                  <li>
                    <span class="player-name">
                      <a href="{{ url_for('player_detail', player_id=player[2]) }}">
                        {{ player[0] }}
                      </a>
                    </span>
                    <span class="player-stat">{{ "%.1f"|format(player[1]) }}</span>
                  </li>
                {% endif %}
              {% else %}
                <li>データがありません</li>
              {% endfor %}
            </ol>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="upcoming-section">
    <h2>今後の試合</h2>
    <div class="upcoming-game-list">
      {% for game in upcoming_games %}
        <div class="upcoming-game-item">
          <div>
            <div class="game-date">{{ game.game_date }} {{ game.start_time }}</div>
            <div class="game-teams">
              {% if game.home_team.logo_image %}<img src="{{ game.home_team.logo_image }}" alt="">{% endif %}
              <a href="{{ url_for('team_detail', team_id=game.home_team.id) }}" style="color: inherit; text-decoration: none;">
                {{ game.home_team.name }}
              </a>
              <span style="color: #ccc; margin: 0 10px;">vs</span>
              <a href="{{ url_for('team_detail', team_id=game.away_team.id) }}" style="color: inherit; text-decoration: none;">
                {{ game.away_team.name }}
              </a>
              {% if game.away_team.logo_image %}<img src="{{ game.away_team.logo_image }}" alt="">{% endif %}
            </div>
          </div>
          <div class="game-link">
            <a href="{{ url_for('edit_game', game_id=game.id) }}">結果入力</a>
          </div>
        </div>
      {% else %}
        <p>予定されている試合はありません。</p>
      {% endfor %}
    </div>
  </section>

</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        // 1. すべてのボタンとコンテンツから active を削除
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // 2. クリックされたボタンと対応するコンテンツに active を追加
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
  });
</script>
{% endblock %}